<!-- content: edition graph -->
<div>
    <!-- modal -->
    <awg-modal #modal></awg-modal>

    <!-- graph -->
    @if (editionGraphData$ | async; as editionGraphData) {
        <div class="awg-graph-view p-5 border rounded-3">
            @for (graph of editionGraphData.graph; track graph) {
                <div>
                    <!-- graph description -->
                    <div class="awg-graph-description">
                        <p>
                            So weit vorhanden, präsentiert die vorliegende Ansicht Graph-Visualisierungen des
                            ausgewählten Editionsbereichs: Der <em>statische Graph</em> vermittelt dabei einen von den
                            jeweiligen Editoren fixierten Überblick editionsrelevanter Zusammenhänge und Abhängigkeiten,
                            der <em>dynamische Graph</em> bietet zusätzlich einen interaktiven Zugang zu dem
                            zugrundeliegenden Datenbestand.
                            <span class="text-danger"
                                >Diese Funktionalität ist noch nicht für alle Skizzenbestandteile verfügbar, wird aber
                                sukzessive ergänzt.</span
                            >
                        </p>
                        @if (utils.isNotEmptyArray(graph.description) || graph.rdfData?.triples) {
                            @for (description of graph.description; track description) {
                                <p [compile-html]="description" [compile-html-ref]="ref"></p>
                            }
                        } @else {
                            <p class="awg-graph-description-empty">
                                <small class="text-muted"
                                    >[Die Graph-Visualisierungen zum Editionskomplex
                                    <span [innerHTML]="editionComplex.complexId.full"></span> erscheinen im Zusammenhang
                                    der vollständigen Edition von {{ editionComplex.complexId.short }} in
                                    {{ editionRouteConstants.EDITION.short }} {{ editionComplex.series.short }}/{{
                                        editionComplex.section.short
                                    }}.]
                                </small>
                            </p>
                        }
                    </div>
                    <!-- dynamic graph -->
                    @if (graph.rdfData && graph.rdfData.triples && graph.rdfData.queryList) {
                        <div class="awg-graph-dynamic">
                            <h4>
                                Dynamischer Graph
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-info ms-2"
                                    (click)="modal.open('HINT_EDITION_GRAPH')">
                                    Hinweise zur Nutzung
                                </button>
                                @if (!isFullscreen) {
                                    <button
                                        type="button"
                                        title="Open fullscreen"
                                        class="btn btn-sm btn-outline-info ms-2"
                                        (click)="openFullscreen()">
                                        <fa-icon [icon]="faExpand"></fa-icon>
                                    </button>
                                }
                                @if (isFullscreen) {
                                    <button
                                        type="button"
                                        title="Close fullscreen"
                                        class="btn btn-sm btn-info ms-2"
                                        (click)="closeFullscreen()">
                                        <fa-icon [icon]="faCompress"></fa-icon>
                                    </button>
                                }
                            </h4>
                            <p>
                                Diese interaktive Visualisierung basiert auf Mads Holten's
                                <a href="https://github.com/MadsHolten/sparql-visualizer">SPARQL Visualizer</a>. Sie
                                modelliert den aktuellen Skizzenkomplex in Form eines
                                <a href="https://www.w3.org/RDF/">RDF</a>-Graphen. Die zugrundeliegenden RDF-Daten sind
                                unter dem Punkt <em>RDF Triples</em> einsehbar und lokal editierbar. Eine Filterung und
                                Eingrenzung dieser RDF-Daten kann mithilfe der Abfragesprache
                                <a href="https://www.w3.org/TR/sparql11-query/">SPARQL</a>
                                unter dem Punkt <em>SPARQL Abfrage</em> vorgenommen werden; in der Voreinstellung werden
                                hierbei alle vorhandenen Triples abgefragt.
                            </p>
                            <awg-graph-visualizer
                                [graphRDFInputData]="graph.rdfData"
                                [isFullscreen]="isFullscreen"></awg-graph-visualizer>
                        </div>
                    }
                    <!-- static image -->
                    @if (graph.staticImage && graph.staticImage !== '') {
                        <div class="awg-graph-static mt-3">
                            <h4>Statischer Graph</h4>
                            <div [compile-html]="graph.staticImage" [compile-html-ref]="ref"></div>
                        </div>
                    }
                </div>
            }
        </div>
    } @else {
        @if (errorObject) {
            <div class="errorMessage">
                <div class="col-12 text-center">
                    <div class="alert alert-danger">{{ errorObject | json }}</div>
                </div>
            </div>
        }
    }

    <!-- error message -->
    <ng-template #error>
        @if (errorObject) {
            <div class="errorMessage">
                <div class="col-12 text-center">
                    <div class="alert alert-danger">{{ errorObject | json }}</div>
                </div>
            </div>
        }
    </ng-template>
</div>
