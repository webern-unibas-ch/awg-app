import{a as O,b as We}from"./chunk-MSTPLEVO.js";import{a as Pt,b as At,c as Lt,d as Ot,e as jt}from"./chunk-D57QBURW.js";import{f as Ee,s as Et}from"./chunk-3ZJIQCL7.js";import{a as qt,i as Ft,k as It,m as Dt}from"./chunk-W3RTTZLA.js";import{c as Nt,x as kt}from"./chunk-GUPLAGXT.js";import"./chunk-7EOCLLXY.js";import{A as gt,D as mt,G as E,J as bt,L as N,Oa as Ue,Q as V,R as S,S as xt,T as w,Ta as Ve,U as k,Ua as wt,V as yt,Va as Rt,W as Ce,X as oe,a as ct,d as Zr,e as Wr,eb as Ze,f as ht,h as Be,hb as St,k as Se,ka as vt,l as v,lb as Y,m as dt,mb as Ct,nb as Tt,ob as Te,t as pt,u as ft,z as _t}from"./chunk-L2YCISRN.js";var $t=Zr((Ui,Qt)=>{var Mt;Qt.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:global):i=>(Mt||(Mt=Promise.resolve())).then(i).catch(e=>setTimeout(()=>{throw e},0))});var zt=`<!-- Data: Triples, SPARQL query, result -->
@if (graphRDFInputData) {
    <div #fs class="row awg-graph-visualizer" [class.is-fullscreen]="isFullscreen">
        <div [ngClass]="isFullscreen ? 'col-4 col-lg-3 px-0 awg-fullscreen' : 'col-12'">
            <div [ngClass]="{ row: !isFullscreen }">
                <div [ngClass]="{ 'col-12 col-lg-6 py-0 pe-lg-0': !isFullscreen }">
                    <!-- awg-graph-triples-editor -->
                    <awg-triples-editor
                        [triples]="triples"
                        [isFullscreen]="isFullscreen"
                        (errorMessageRequest)="showErrorMessage($event)"
                        (performQueryRequest)="performQuery()"
                        (resetTriplesRequest)="resetTriples()"
                        (updateTriplesRequest)="triples = $event"></awg-triples-editor>
                </div>
                <div [ngClass]="{ 'col-12 col-lg-6 py-0 ps-lg-0': !isFullscreen }">
                    <!-- awg-graph-sparql-editor -->
                    <awg-sparql-editor
                        [queryList]="queryList"
                        [query]="query"
                        [isFullscreen]="isFullscreen"
                        (errorMessageRequest)="showErrorMessage($event)"
                        (performQueryRequest)="performQuery()"
                        (resetQueryRequest)="resetQuery($event)"
                        (updateQueryStringRequest)="query.queryString = $event"></awg-sparql-editor>
                </div>
            </div>
        </div>
        <!-- Results -->
        <div [ngClass]="isFullscreen ? 'col-8 col-lg-9 px-0 awg-fullscreen' : 'col-12'">
            <!-- CONSTRUCT -->
            <!-- awg-graph-construct-result -->
            @if (query.queryType === 'construct') {
                <awg-construct-results
                    #queryConstructResultAcc
                    [queryResult$]="queryResult$"
                    [defaultForceGraphHeight]="isFullscreen ? 1000 : defaultForceGraphHeight"
                    [isFullscreen]="isFullscreen"
                    (clickedNodeRequest)="onGraphNodeClick($event)"></awg-construct-results>
            } @else {
                @if (query.queryType === 'select') {
                    <awg-select-results
                        [queryResult$]="queryResult$"
                        [queryTime]="queryTime"
                        [isFullscreen]="isFullscreen"
                        (clickedTableRequest)="onTableNodeClick($event)"></awg-select-results>
                } @else {
                    <awg-unsupported-type-results
                        [queryType]="query.queryType"
                        [isFullscreen]="isFullscreen"></awg-unsupported-type-results>
                }
            }
            <!-- SELECT -->
            <!-- awg-graph-select-result -->
            <!-- OTHERS -->
            <!-- awg-graph-unsupported-query-type-result -->
        </div>
    </div>
}

<awg-toast aria-live="polite" aria-atomic="true"></awg-toast>
`;var Gt=`:host::ng-deep .awg-fullscreen .collapse.show{height:100vh}:host::ng-deep .awg-fullscreen #awg-graph-visualizer-triples.collapse.show{height:45vh}:host::ng-deep .awg-fullscreen #awg-graph-visualizer-query.collapse.show{height:50vh}
`;var Bt=Wr($t());var me="http://www.w3.org/1999/02/22-rdf-syntax-ns#",be="http://www.w3.org/2001/XMLSchema#",Xe="http://www.w3.org/2000/10/swap/",L={xsd:{decimal:`${be}decimal`,boolean:`${be}boolean`,double:`${be}double`,integer:`${be}integer`,string:`${be}string`},rdf:{type:`${me}type`,nil:`${me}nil`,first:`${me}first`,rest:`${me}rest`,langString:`${me}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${Xe}reify#forSome`,forAll:`${Xe}reify#forAll`},log:{implies:`${Xe}log#implies`}};var{xsd:Ne}=L,Jr=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,Ht={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},Yr=/[\x00-\x20<>\\"\{\}\|\^\`]/,ei={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},ti=/$0^/,xe=class{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._lineMode=!!e.lineMode){this._n3Mode=!1;for(let t in this)!(t in ei)&&this[t]instanceof RegExp&&(this[t]=ti)}else this._n3Mode=e.n3!==!1;this._comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,t){let r=this._input,s=r.length;for(;;){let o,u;for(;o=this._newline.exec(r);)this._comments&&(u=this._comment.exec(o[0]))&&n("comment",u[1],"",this._line,o[0].length),r=r.substr(o[0].length,r.length),s=r.length,this._line++;if(!o&&(o=this._whitespace.exec(r))&&(r=r.substr(o[0].length,r.length)),this._endOfFile.test(r))return t&&(this._comments&&(u=this._comment.exec(r))&&n("comment",u[1],"",this._line,r.length),r=null,n("eof","","",this._line,0)),this._input=r;let l=this._line,m=r[0],p="",_="",f="",d=null,c=0,h=!1;switch(m){case"^":if(r.length<3)break;if(r[1]==="^"){if(this._previousMarker="^^",r=r.substr(2),r[0]!=="<"){h=!0;break}}else{this._n3Mode&&(c=1,p="^");break}case"<":if(d=this._unescapedIri.exec(r))p="IRI",_=d[1];else if(d=this._iri.exec(r)){if(_=this._unescape(d[1]),_===null||Yr.test(_))return a(this);p="IRI"}else r.length>1&&r[1]==="<"?(p="<<",c=2):this._n3Mode&&r.length>1&&r[1]==="="&&(p="inverse",c=2,_=">");break;case">":r.length>1&&r[1]===">"&&(p=">>",c=2);break;case"_":((d=this._blank.exec(r))||t&&(d=this._blank.exec(`${r} `)))&&(p="blank",f="_",_=d[1]);break;case'"':if(d=this._simpleQuotedString.exec(r))_=d[1];else if({value:_,matchLength:c}=this._parseLiteral(r),_===null)return a(this);(d!==null||c!==0)&&(p="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(d=this._simpleApostropheString.exec(r))_=d[1];else if({value:_,matchLength:c}=this._parseLiteral(r),_===null)return a(this);(d!==null||c!==0)&&(p="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(d=this._variable.exec(r))&&(p="var",_=d[0]);break;case"@":this._previousMarker==="literal"&&(d=this._langcode.exec(r))?(p="langcode",_=d[1]):(d=this._keyword.exec(r))&&(p=d[0]);break;case".":if(r.length===1?t:r[1]<"0"||r[1]>"9"){p=".",c=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(d=this._number.exec(r)||t&&(d=this._number.exec(`${r} `)))&&(p="literal",_=d[0],f=typeof d[1]=="string"?Ne.double:typeof d[2]=="string"?Ne.decimal:Ne.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(d=this._sparqlKeyword.exec(r))?p=d[0].toUpperCase():h=!0;break;case"f":case"t":(d=this._boolean.exec(r))?(p="literal",_=d[0],f=Ne.boolean):h=!0;break;case"a":(d=this._shortPredicates.exec(r))?(p="abbreviation",_="a"):h=!0;break;case"=":this._n3Mode&&r.length>1&&(p="abbreviation",r[1]!==">"?(c=1,_="="):(c=2,_=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(c=1,p=m);break;case"{":!this._lineMode&&r.length>=2&&(r[1]==="|"?(p="{|",c=2):(p=m,c=1));break;case"|":r.length>=2&&r[1]==="}"&&(p="|}",c=2);break;default:h=!0}if(h&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(d=this._prefix.exec(r))?(p="prefix",_=d[1]||""):((d=this._prefixed.exec(r))||t&&(d=this._prefixed.exec(`${r} `)))&&(p="prefixed",f=d[1]||"",_=this._unescape(d[2]))),this._previousMarker==="^^")switch(p){case"prefixed":p="type";break;case"IRI":p="typeIRI";break;default:p=""}if(!p)return t||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?a(this):this._input=r;let g=c||d[0].length,b=n(p,_,f,l,g);this.previousToken=b,this._previousMarker=p,r=r.substr(g,r.length)}function n(o,u,l,m,p){let _=r?s-r.length:s,f=_+p,d={type:o,value:u,prefix:l,line:m,start:_,end:f};return e(null,d),d}function a(o){e(o._syntaxError(/^\S*/.exec(r)[0]))}}_unescape(e){let t=!1,r=e.replace(Jr,(s,n,a,o)=>{if(typeof n=="string")return String.fromCharCode(Number.parseInt(n,16));if(typeof a=="string"){let u=Number.parseInt(a,16);return u<=65535?String.fromCharCode(Number.parseInt(a,16)):String.fromCharCode(55296+((u-=65536)>>10),56320+(u&1023))}return o in Ht?Ht[o]:(t=!0,"")});return t?null:r}_parseLiteral(e){if(e.length>=3){let t=e.match(/^(?:"""|"|'''|'|)/)[0],r=t.length,s=Math.max(this._literalClosingPos,r);for(;(s=e.indexOf(t,s))>0;){let n=0;for(;e[s-n-1]==="\\";)n++;if(n%2===0){let a=e.substring(r,s),o=a.split(/\r\n|\r|\n/).length-1,u=s+r;if(r===1&&o!==0||r===3&&this._lineMode)break;return this._line+=o,{value:this._unescape(a),matchLength:u}}s++}this._literalClosingPos=e.length-r+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;let t=new Error(`Unexpected "${e}" on line ${this._line}.`);return t.context={token:void 0,line:this._line,previousToken:this.previousToken},t}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,t){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof t=="function")(0,Bt.default)(()=>this._tokenizeToEnd(t,!0));else{let r=[],s;if(this._tokenizeToEnd((n,a)=>n?s=n:r.push(a),!0),s)throw s;return r}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",r=>{this._input!==null&&r.length!==0&&(this._pendingBuffer&&(r=Buffer.concat([this._pendingBuffer,r]),this._pendingBuffer=null),r[r.length-1]&128?this._pendingBuffer=r:(typeof this._input>"u"?this._input=this._readStartingBom(typeof r=="string"?r:r.toString()):this._input+=r,this._tokenizeToEnd(t,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(t,!0)}),e.on("error",t)}};var{rdf:ri,xsd:le}=L,qe,ii=0;var si={namedNode:ni,blankNode:ai,variable:li,literal:oi,defaultGraph:ui,quad:Ut,triple:Ut},Vt=si,Z=class i{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof i?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}},ke=class extends Z{get termType(){return"NamedNode"}},ye=class i extends Z{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){let e=this.id,t=e.lastIndexOf('"')+1;return t<e.length&&e[t++]==="@"?e.substr(t).toLowerCase():""}get datatype(){return new ke(this.datatypeString)}get datatypeString(){let e=this.id,t=e.lastIndexOf('"')+1,r=t<e.length?e[t]:"";return r==="^"?e.substr(t+2):r!=="@"?le.string:ri.langString}equals(e){return e instanceof i?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}},Ke=class extends Z{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}},Je=class extends Z{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}},Ye=class extends Z{constructor(){return super(""),qe||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}};qe=new Ye;var et=class extends Z{constructor(e,t,r,s){super(""),this._subject=e,this._predicate=t,this._object=r,this._graph=s||qe}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}};function ni(i){return new ke(i)}function ai(i){return new Ke(i||`n3-${ii++}`)}function oi(i,e){if(typeof e=="string")return new ye(`"${i}"@${e.toLowerCase()}`);let t=e?e.value:"";return t===""&&(typeof i=="boolean"?t=le.boolean:typeof i=="number"&&(Number.isFinite(i)?t=Number.isInteger(i)?le.integer:le.double:(t=le.double,Number.isNaN(i)||(i=i>0?"INF":"-INF")))),t===""||t===le.string?new ye(`"${i}"`):new ye(`"${i}"^^${t}`)}function li(i){return new Je(i)}function ui(){return qe}function Ut(i,e,t,r){return new et(i,e,t,r)}var Zt=0,W=class{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&Wt(this,e.factory);let t=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",r=/turtle/.test(t),s=/trig/.test(t),n=/triple/.test(t),a=/quad/.test(t),o=this._n3Mode=/n3/.test(t),u=n||a;(this._supportsNamedGraphs=!(r||o))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(r||s||n||o),this._supportsRDFStar=t===""||/star|\*$/.test(t),u&&(this._resolveRelativeIRI=l=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new xe({lineMode:u,n3:o}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){Zt=0}_setBase(e){if(!e)this._base="",this._basePath="";else{let t=e.indexOf("#");t>=0&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,t,r,s,n){let a=this._n3Mode;this._contextStack.push({type:e,subject:r,predicate:s,object:n,graph:t,inverse:a?this._inversePredicate:!1,blankPrefix:a?this._prefixes._:"",quantified:a?this._quantified:null}),a&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,t){let r=this._contextStack.pop();if(!r||r.type!==e)return this._error(`Unexpected ${t.type}`,t);this._subject=r.subject,this._predicate=r.predicate,this._object=r.object,this._graph=r.graph,this._n3Mode&&(this._inversePredicate=r.inverse,this._prefixes._=r.blankPrefix,this._quantified=r.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,t){let r;switch(e.type){case"IRI":case"typeIRI":let s=this._resolveIRI(e.value);if(s===null)return this._error("Invalid IRI",e);r=this._namedNode(s);break;case"type":case"prefixed":let n=this._prefixes[e.prefix];if(n===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);r=this._namedNode(n+e.value);break;case"blank":r=this._blankNode(this._prefixes[e.prefix]+e.value);break;case"var":r=this._variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!t&&this._n3Mode&&r.id in this._quantified&&(r=this._quantified[r.id]),r}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier=this._blankNode,this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier=this._variable,this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._literal(e.value,this._namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){let t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${t}`,e):(this._subject=null,t==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._literal(e.value,this._namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF* syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);let t=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:t?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let t=null,r=null,s=this._readListItem,n=this._subject,a=this._contextStack,o=a[a.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,r=this._blankNode(),this.RDF_FIRST,this._subject=t=this._blankNode()),s=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,r=this._blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),a.length!==0&&a[a.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(s=this._readPredicate,this._subject===this.RDF_NIL)return s}else if(s=this._getContextEndReader(),this._object===this.RDF_NIL)return s;r=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,s=this._readListItemDataTypeOrLang):(t=this._literal(e.value,this._namedNode(e.prefix)),s=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((t=this._readEntity(e))===void 0)return}if(r===null&&(this._subject=r=this._blankNode()),n===null?o.predicate===null?o.subject=r:o.object=r:this._emit(n,this.RDF_REST,r,this._graph),t!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,r,this.RDF_FIRST,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);this._emit(r,this.RDF_FIRST,t,this._graph)}return s}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let t=this._literal(this._literalValue);switch(e.type){case"type":case"typeIRI":let r=this._readEntity(e);if(r===void 0)return;t=this._literal(this._literalValue,r),e=null;break;case"langcode":t=this._literal(this._literalValue,e.value),e=null;break}return{token:e,literal:t}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,t){let r=this._completeLiteral(e);if(r)return this._object=r.literal,t&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),r.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(r.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let t,r=this._graph,s=this._subject,n=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,n&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF* syntax",e);let a=this._predicate,o=this._object;this._subject=this._quad(s,a,o,this.DEFAULTGRAPH),t=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,t=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(r=this._readEntity(e))!==void 0){t=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(s!==null){let a=this._predicate,o=this._object;n?this._emit(o,a,s,r):this._emit(s,a,o,r)}return t}_readBlankNodePunctuation(e){let t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),t}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);let t=this._readEntity(e);return this._prefixes[this._prefix]=t.value,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation}_readBaseIRI(e){let t=e.type==="IRI"&&this._resolveIRI(e.value);return t?(this._setBase(t),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let t;switch(e.type){case"IRI":case"prefixed":if((t=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,t,this.QUANTIFIERS_GRAPH)):this._quantified[t.id]=this._quantifier(this._blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:let t=this._contextStack,r=t.length&&t[t.length-1];if(r&&r.type==="item"){let s=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,s,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let t,r,s=this._blankNode();if((r=this._readEntity(e))!==void 0)return this._predicate===null?(t=this._subject,this._subject=s):(t=this._object,this._object=s),this._emit(t,r,s,this._graph),this._readPath}_readBackwardPath(e){let t=this._blankNode(),r,s;if((r=this._readEntity(e))!==void 0)return this._predicate===null?(s=this._subject,this._subject=t):(s=this._object,this._object=t),this._emit(t,r,s,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);let t=this._quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=t,this._readPredicate):(this._object=t,this._getContextEndReader())}_getContextEndReader(){let e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,t,r,s){this._callback(null,this._quad(e,t,r,s||this.DEFAULTGRAPH))}_error(e,t){let r=new Error(`${e} on line ${t.line}.`);r.context={token:t,line:t.line,previousToken:this._lexer.previousToken},this._callback(r),this._callback=tt}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;let t=e.length,r="",s=-1,n=-1,a=0,o="/";for(;s<t;){switch(o){case":":if(n<0&&e[++s]==="/"&&e[++s]==="/")for(;(n=s+1)<t&&e[n]!=="/";)s=n;break;case"?":case"#":s=t;break;case"/":if(e[s+1]===".")switch(o=e[++s+1],o){case"/":r+=e.substring(a,s-1),a=s+1;break;case void 0:case"?":case"#":return r+e.substring(a,s)+e.substr(s+1);case".":if(o=e[++s+1],o===void 0||o==="/"||o==="?"||o==="#"){if(r+=e.substring(a,s-2),(a=r.lastIndexOf("/"))>=n&&(r=r.substr(0,a)),o!=="/")return`${r}/${e.substr(s+1)}`;a=s+1}}}o=e[++s]}return r+e.substring(a)}parse(e,t,r){if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${Zt++}_`,this._prefixCallback=r||tt,this._inversePredicate=!1,this._quantified=Object.create(null),!t){let s=[],n;if(this._callback=(a,o)=>{a?n=a:o&&s.push(o)},this._lexer.tokenize(e).every(a=>this._readCallback=this._readCallback(a)),n)throw n;return s}this._callback=t,this._lexer.tokenize(e,(s,n)=>{s!==null?(this._callback(s),this._callback=tt):this._readCallback&&(this._readCallback=this._readCallback(n))})}};function tt(){}function Wt(i,e){let t=e.namedNode;i._namedNode=t,i._blankNode=e.blankNode,i._literal=e.literal,i._variable=e.variable,i._quad=e.quad,i.DEFAULTGRAPH=e.defaultGraph(),i.RDF_FIRST=t(L.rdf.first),i.RDF_REST=t(L.rdf.rest),i.RDF_NIL=t(L.rdf.nil),i.N3_FORALL=t(L.r.forAll),i.N3_FORSOME=t(L.r.forSome),i.ABBREVIATIONS={a:t(L.rdf.type),"=":t(L.owl.sameAs),">":t(L.log.implies)},i.QUANTIFIERS_GRAPH=t("urn:n3:quantifiers")}Wt(W.prototype,Vt);function rt(i,e){var t,r=1;i==null&&(i=0),e==null&&(e=0);function s(){var n,a=t.length,o,u=0,l=0;for(n=0;n<a;++n)o=t[n],u+=o.x,l+=o.y;for(u=(u/a-i)*r,l=(l/a-e)*r,n=0;n<a;++n)o=t[n],o.x-=u,o.y-=l}return s.initialize=function(n){t=n},s.x=function(n){return arguments.length?(i=+n,s):i},s.y=function(n){return arguments.length?(e=+n,s):e},s.strength=function(n){return arguments.length?(r=+n,s):r},s}function Xt(i){let e=+this._x.call(null,i),t=+this._y.call(null,i);return Kt(this.cover(e,t),e,t,i)}function Kt(i,e,t,r){if(isNaN(e)||isNaN(t))return i;var s,n=i._root,a={data:r},o=i._x0,u=i._y0,l=i._x1,m=i._y1,p,_,f,d,c,h,g,b;if(!n)return i._root=a,i;for(;n.length;)if((c=e>=(p=(o+l)/2))?o=p:l=p,(h=t>=(_=(u+m)/2))?u=_:m=_,s=n,!(n=n[g=h<<1|c]))return s[g]=a,i;if(f=+i._x.call(null,n.data),d=+i._y.call(null,n.data),e===f&&t===d)return a.next=n,s?s[g]=a:i._root=a,i;do s=s?s[g]=new Array(4):i._root=new Array(4),(c=e>=(p=(o+l)/2))?o=p:l=p,(h=t>=(_=(u+m)/2))?u=_:m=_;while((g=h<<1|c)===(b=(d>=_)<<1|f>=p));return s[b]=n,s[g]=a,i}function Jt(i){var e,t,r=i.length,s,n,a=new Array(r),o=new Array(r),u=1/0,l=1/0,m=-1/0,p=-1/0;for(t=0;t<r;++t)isNaN(s=+this._x.call(null,e=i[t]))||isNaN(n=+this._y.call(null,e))||(a[t]=s,o[t]=n,s<u&&(u=s),s>m&&(m=s),n<l&&(l=n),n>p&&(p=n));if(u>m||l>p)return this;for(this.cover(u,l).cover(m,p),t=0;t<r;++t)Kt(this,a[t],o[t],i[t]);return this}function Yt(i,e){if(isNaN(i=+i)||isNaN(e=+e))return this;var t=this._x0,r=this._y0,s=this._x1,n=this._y1;if(isNaN(t))s=(t=Math.floor(i))+1,n=(r=Math.floor(e))+1;else{for(var a=s-t||1,o=this._root,u,l;t>i||i>=s||r>e||e>=n;)switch(l=(e<r)<<1|i<t,u=new Array(4),u[l]=o,o=u,a*=2,l){case 0:s=t+a,n=r+a;break;case 1:t=s-a,n=r+a;break;case 2:s=t+a,r=n-a;break;case 3:t=s-a,r=n-a;break}this._root&&this._root.length&&(this._root=o)}return this._x0=t,this._y0=r,this._x1=s,this._y1=n,this}function er(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function tr(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function q(i,e,t,r,s){this.node=i,this.x0=e,this.y0=t,this.x1=r,this.y1=s}function rr(i,e,t){var r,s=this._x0,n=this._y0,a,o,u,l,m=this._x1,p=this._y1,_=[],f=this._root,d,c;for(f&&_.push(new q(f,s,n,m,p)),t==null?t=1/0:(s=i-t,n=e-t,m=i+t,p=e+t,t*=t);d=_.pop();)if(!(!(f=d.node)||(a=d.x0)>m||(o=d.y0)>p||(u=d.x1)<s||(l=d.y1)<n))if(f.length){var h=(a+u)/2,g=(o+l)/2;_.push(new q(f[3],h,g,u,l),new q(f[2],a,g,h,l),new q(f[1],h,o,u,g),new q(f[0],a,o,h,g)),(c=(e>=g)<<1|i>=h)&&(d=_[_.length-1],_[_.length-1]=_[_.length-1-c],_[_.length-1-c]=d)}else{var b=i-+this._x.call(null,f.data),y=e-+this._y.call(null,f.data),x=b*b+y*y;if(x<t){var R=Math.sqrt(t=x);s=i-R,n=e-R,m=i+R,p=e+R,r=f.data}}return r}function ir(i){if(isNaN(m=+this._x.call(null,i))||isNaN(p=+this._y.call(null,i)))return this;var e,t=this._root,r,s,n,a=this._x0,o=this._y0,u=this._x1,l=this._y1,m,p,_,f,d,c,h,g;if(!t)return this;if(t.length)for(;;){if((d=m>=(_=(a+u)/2))?a=_:u=_,(c=p>=(f=(o+l)/2))?o=f:l=f,e=t,!(t=t[h=c<<1|d]))return this;if(!t.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(r=e,g=h)}for(;t.data!==i;)if(s=t,!(t=t.next))return this;return(n=t.next)&&delete t.next,s?(n?s.next=n:delete s.next,this):e?(n?e[h]=n:delete e[h],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[g]=t:this._root=t),this):(this._root=n,this)}function sr(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function nr(){return this._root}function ar(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function or(i){var e=[],t,r=this._root,s,n,a,o,u;for(r&&e.push(new q(r,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!i(r=t.node,n=t.x0,a=t.y0,o=t.x1,u=t.y1)&&r.length){var l=(n+o)/2,m=(a+u)/2;(s=r[3])&&e.push(new q(s,l,m,o,u)),(s=r[2])&&e.push(new q(s,n,m,l,u)),(s=r[1])&&e.push(new q(s,l,a,o,m)),(s=r[0])&&e.push(new q(s,n,a,l,m))}return this}function lr(i){var e=[],t=[],r;for(this._root&&e.push(new q(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var s=r.node;if(s.length){var n,a=r.x0,o=r.y0,u=r.x1,l=r.y1,m=(a+u)/2,p=(o+l)/2;(n=s[0])&&e.push(new q(n,a,o,m,p)),(n=s[1])&&e.push(new q(n,m,o,u,p)),(n=s[2])&&e.push(new q(n,a,p,m,l)),(n=s[3])&&e.push(new q(n,m,p,u,l))}t.push(r)}for(;r=t.pop();)i(r.node,r.x0,r.y0,r.x1,r.y1);return this}function ur(i){return i[0]}function cr(i){return arguments.length?(this._x=i,this):this._x}function hr(i){return i[1]}function dr(i){return arguments.length?(this._y=i,this):this._y}function ee(i,e,t){var r=new it(e??ur,t??hr,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function it(i,e,t,r,s,n){this._x=i,this._y=e,this._x0=t,this._y0=r,this._x1=s,this._y1=n,this._root=void 0}function pr(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var P=ee.prototype=it.prototype;P.copy=function(){var i=new it(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,r;if(!e)return i;if(!e.length)return i._root=pr(e),i;for(t=[{source:e,target:i._root=new Array(4)}];e=t.pop();)for(var s=0;s<4;++s)(r=e.source[s])&&(r.length?t.push({source:r,target:e.target[s]=new Array(4)}):e.target[s]=pr(r));return i};P.add=Xt;P.addAll=Jt;P.cover=Yt;P.data=er;P.extent=tr;P.find=rr;P.remove=ir;P.removeAll=sr;P.root=nr;P.size=ar;P.visit=or;P.visitAfter=lr;P.x=cr;P.y=dr;function G(i){return function(){return i}}function z(i){return(i()-.5)*1e-6}function hi(i){return i.x+i.vx}function di(i){return i.y+i.vy}function st(i){var e,t,r,s=1,n=1;typeof i!="function"&&(i=G(i==null?1:+i));function a(){for(var l,m=e.length,p,_,f,d,c,h,g=0;g<n;++g)for(p=ee(e,hi,di).visitAfter(o),l=0;l<m;++l)_=e[l],c=t[_.index],h=c*c,f=_.x+_.vx,d=_.y+_.vy,p.visit(b);function b(y,x,R,D,A){var C=y.data,j=y.r,T=c+j;if(C){if(C.index>_.index){var B=f-C.x-C.vx,U=d-C.y-C.vy,M=B*B+U*U;M<T*T&&(B===0&&(B=z(r),M+=B*B),U===0&&(U=z(r),M+=U*U),M=(T-(M=Math.sqrt(M)))/M*s,_.vx+=(B*=M)*(T=(j*=j)/(h+j)),_.vy+=(U*=M)*T,C.vx-=B*(T=1-T),C.vy-=U*T)}return}return x>f+T||D<f-T||R>d+T||A<d-T}}function o(l){if(l.data)return l.r=t[l.data.index];for(var m=l.r=0;m<4;++m)l[m]&&l[m].r>l.r&&(l.r=l[m].r)}function u(){if(e){var l,m=e.length,p;for(t=new Array(m),l=0;l<m;++l)p=e[l],t[p.index]=+i(p,l,e)}}return a.initialize=function(l,m){e=l,r=m,u()},a.iterations=function(l){return arguments.length?(n=+l,a):n},a.strength=function(l){return arguments.length?(s=+l,a):s},a.radius=function(l){return arguments.length?(i=typeof l=="function"?l:G(+l),u(),a):i},a}function pi(i){return i.index}function fr(i,e){var t=i.get(e);if(!t)throw new Error("node not found: "+e);return t}function nt(i){var e=pi,t=p,r,s=G(30),n,a,o,u,l,m=1;i==null&&(i=[]);function p(h){return 1/Math.min(o[h.source.index],o[h.target.index])}function _(h){for(var g=0,b=i.length;g<m;++g)for(var y=0,x,R,D,A,C,j,T;y<b;++y)x=i[y],R=x.source,D=x.target,A=D.x+D.vx-R.x-R.vx||z(l),C=D.y+D.vy-R.y-R.vy||z(l),j=Math.sqrt(A*A+C*C),j=(j-n[y])/j*h*r[y],A*=j,C*=j,D.vx-=A*(T=u[y]),D.vy-=C*T,R.vx+=A*(T=1-T),R.vy+=C*T}function f(){if(a){var h,g=a.length,b=i.length,y=new Map(a.map((R,D)=>[e(R,D,a),R])),x;for(h=0,o=new Array(g);h<b;++h)x=i[h],x.index=h,typeof x.source!="object"&&(x.source=fr(y,x.source)),typeof x.target!="object"&&(x.target=fr(y,x.target)),o[x.source.index]=(o[x.source.index]||0)+1,o[x.target.index]=(o[x.target.index]||0)+1;for(h=0,u=new Array(b);h<b;++h)x=i[h],u[h]=o[x.source.index]/(o[x.source.index]+o[x.target.index]);r=new Array(b),d(),n=new Array(b),c()}}function d(){if(a)for(var h=0,g=i.length;h<g;++h)r[h]=+t(i[h],h,i)}function c(){if(a)for(var h=0,g=i.length;h<g;++h)n[h]=+s(i[h],h,i)}return _.initialize=function(h,g){a=h,l=g,f()},_.links=function(h){return arguments.length?(i=h,f(),_):i},_.id=function(h){return arguments.length?(e=h,_):e},_.iterations=function(h){return arguments.length?(m=+h,_):m},_.strength=function(h){return arguments.length?(t=typeof h=="function"?h:G(+h),d(),_):t},_.distance=function(h){return arguments.length?(s=typeof h=="function"?h:G(+h),c(),_):s},_}function _r(){let i=1;return()=>(i=(1664525*i+1013904223)%4294967296)/4294967296}function gr(i){return i.x}function mr(i){return i.y}var fi=10,_i=Math.PI*(3-Math.sqrt(5));function at(i){var e,t=1,r=.001,s=1-Math.pow(r,1/300),n=0,a=.6,o=new Map,u=Ot(p),l=At("tick","end"),m=_r();i==null&&(i=[]);function p(){_(),l.call("tick",e),t<r&&(u.stop(),l.call("end",e))}function _(c){var h,g=i.length,b;c===void 0&&(c=1);for(var y=0;y<c;++y)for(t+=(n-t)*s,o.forEach(function(x){x(t)}),h=0;h<g;++h)b=i[h],b.fx==null?b.x+=b.vx*=a:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=a:(b.y=b.fy,b.vy=0);return e}function f(){for(var c=0,h=i.length,g;c<h;++c){if(g=i[c],g.index=c,g.fx!=null&&(g.x=g.fx),g.fy!=null&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var b=fi*Math.sqrt(.5+c),y=c*_i;g.x=b*Math.cos(y),g.y=b*Math.sin(y)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function d(c){return c.initialize&&c.initialize(i,m),c}return f(),e={tick:_,restart:function(){return u.restart(p),e},stop:function(){return u.stop(),e},nodes:function(c){return arguments.length?(i=c,f(),o.forEach(d),e):i},alpha:function(c){return arguments.length?(t=+c,e):t},alphaMin:function(c){return arguments.length?(r=+c,e):r},alphaDecay:function(c){return arguments.length?(s=+c,e):+s},alphaTarget:function(c){return arguments.length?(n=+c,e):n},velocityDecay:function(c){return arguments.length?(a=1-c,e):1-a},randomSource:function(c){return arguments.length?(m=c,o.forEach(d),e):m},force:function(c,h){return arguments.length>1?(h==null?o.delete(c):o.set(c,d(h)),e):o.get(c)},find:function(c,h,g){var b=0,y=i.length,x,R,D,A,C;for(g==null?g=1/0:g*=g,b=0;b<y;++b)A=i[b],x=c-A.x,R=h-A.y,D=x*x+R*R,D<g&&(C=A,g=D);return C},on:function(c,h){return arguments.length>1?(l.on(c,h),e):l.on(c)}}}function ot(){var i,e,t,r,s=G(-30),n,a=1,o=1/0,u=.81;function l(f){var d,c=i.length,h=ee(i,gr,mr).visitAfter(p);for(r=f,d=0;d<c;++d)e=i[d],h.visit(_)}function m(){if(i){var f,d=i.length,c;for(n=new Array(d),f=0;f<d;++f)c=i[f],n[c.index]=+s(c,f,i)}}function p(f){var d=0,c,h,g=0,b,y,x;if(f.length){for(b=y=x=0;x<4;++x)(c=f[x])&&(h=Math.abs(c.value))&&(d+=c.value,g+=h,b+=h*c.x,y+=h*c.y);f.x=b/g,f.y=y/g}else{c=f,c.x=c.data.x,c.y=c.data.y;do d+=n[c.data.index];while(c=c.next)}f.value=d}function _(f,d,c,h){if(!f.value)return!0;var g=f.x-e.x,b=f.y-e.y,y=h-d,x=g*g+b*b;if(y*y/u<x)return x<o&&(g===0&&(g=z(t),x+=g*g),b===0&&(b=z(t),x+=b*b),x<a&&(x=Math.sqrt(a*x)),e.vx+=g*f.value*r/x,e.vy+=b*f.value*r/x),!0;if(f.length||x>=o)return;(f.data!==e||f.next)&&(g===0&&(g=z(t),x+=g*g),b===0&&(b=z(t),x+=b*b),x<a&&(x=Math.sqrt(a*x)));do f.data!==e&&(y=n[f.data.index]*r/x,e.vx+=g*y,e.vy+=b*y);while(f=f.next)}return l.initialize=function(f,d){i=f,t=d,m()},l.strength=function(f){return arguments.length?(s=typeof f=="function"?f:G(+f),m(),l):s},l.distanceMin=function(f){return arguments.length?(a=f*f,l):Math.sqrt(a)},l.distanceMax=function(f){return arguments.length?(o=f*f,l):Math.sqrt(o)},l.theta=function(f){return arguments.length?(u=f*f,l):Math.sqrt(u)},l}var an={LINK_DISTANCE:1/50,COLLISION_STRENGTH:1,CHARGE_STRENGTH:-1};var ve=class{constructor(){this.nodes=[],this.links=[],this.nodeTriples=[]}};var ue=class{constructor(e,t){let r="";this.source=e,this.target=t,this.predicate=r,this.weight=1}};var we=class{constructor(e,t,r){this.nodeSubject=e,this.nodePredicate=t,this.nodeObject=r}};var Q;(function(i){i.link="link",i.node="node"})(Q||(Q={}));var te=class{constructor(e,t){this.id=e,this.label=e,this.weight=1,this.type=t,this.owlClass=!1,this.instance=!1}};var X;(function(i){i.TURTLE="TURTLE",i.SPARQL="SPARQL"})(X||(X={}));var I;(function(i){i.SHORT="short",i.LONG="long"})(I||(I={}));var F=class{constructor(e,t){this.prefixName=e,this.prefixIri=t}};var lt=[new F("awg","https://edition.anton-webern.ch/webern-onto#"),new F("dbo","http://dbpedia.org/ontology/"),new F("dbp","http://dbpedia.org/property/"),new F("dbpedia","http://dbpedia.org/resource/"),new F("dc","http://purl.org/dc/elements/1.1/"),new F("dcterms","http://purl.org/dc/terms/"),new F("foaf","http://xmlns.com/foaf/0.1/"),new F("mo","http://purl.org/ontology/mo/"),new F("owl","http://www.w3.org/2002/07/owl#"),new F("prov","http://www.w3.org/ns/prov#"),new F("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),new F("rdfs","http://www.w3.org/2000/01/rdf-schema#"),new F("skos","http://www.w3.org/2004/02/skos/core#"),new F("xsd","http://www.w3.org/2001/XMLSchema#")];var $=class{constructor(){this.defaultPrefixes=lt}transform(e,t){let r;switch(t){case I.SHORT:{this.defaultPrefixes.forEach(s=>{e.indexOf(s.prefixIri)!==-1&&(r=e.replace(s.prefixIri,s.prefixName+":"))});break}case I.LONG:{this.defaultPrefixes.forEach(s=>{e.indexOf(s.prefixName)!==-1&&(r=e.replace(s.prefixName+":",s.prefixIri))});break}default:{let s=t;throw new Error(`The prefixForm must be ${I.SHORT} or ${I.LONG}, but was: ${s}.`)}}return r||e}};$=v([xt({name:"prefix",pure:!1})],$);var ce,K=(ce=class{constructor(e){this.prefixPipe=e}parseTripleString(e){let t=new W,r=[];return new Promise((s,n)=>{t.parse(e,(a,o,u)=>{o?r.push(o):s({triples:r,namespaces:u}),a&&n(a)})})}limitTriples(e,t){return e?e.length>t?e.slice(0,t):e:[]}abbreviateTriples(e,t,r){return r||(r="text/turtle"),e.map(s=>{let n=s.subject.nominalValue,a=s.predicate.nominalValue,o=s.object.nominalValue;return r==="text/turtle"&&(this._abbreviate(n,t)!=null&&(n=this._abbreviate(n,t)),this._abbreviate(a,t)!=null&&(a=this._abbreviate(a,t)),this._abbreviate(o,t)!=null&&(o=this._abbreviate(o,t))),{subject:n,predicate:a,object:o}})}checkNamespacesInQuery(e,t){if(!e||!t)return;let r=this._extractNamespacesFromString(X.TURTLE,t),s=this._extractNamespacesFromString(X.SPARQL,e),n=this._extractQNamesFromSPARQLWhereClause(e),a=Object.keys(r),o=Object.keys(s),u="";return a.forEach(l=>{o.indexOf(l)===-1&&(u+=`PREFIX ${l} ${r[l]}
`)}),n.length>0&&n.forEach(l=>{if(o.indexOf(l)===-1){console.warn(`Prefix '${l}' not declared in SPARQL and/or Turtle header. Searching in default namespaces...`);let m=this.prefixPipe.transform(l,I.LONG);if(m!==l){let p=`PREFIX ${l} <${m}>
`;u+=p,console.warn(`Added '${p}' to SPARQL prefixes from list of default namespaces.`)}else console.warn(`'${l}' is unknown. Please provide a declaration.`)}}),u!==""&&(e=u+e),e}doQuery(e,t,r,s){return s||(s="text/turtle"),this._createStore().then(n=>(this._store=n,this._loadTriplesInStore(n,r,s))).then(n=>this._executeQuery(this._store,t)).then(n=>{if(e==="select"){let a=n;return this._prepareSelectResponse(a).data}if(e==="construct"){let a=n;return this._getNamespaces(r).then(o=>this.abbreviateTriples(a.triples,o,s))}})}getQuerytype(e){let t=[{queryType:"select",index:-1},{queryType:"construct",index:-1},{queryType:"ask",index:-1},{queryType:"count",index:-1},{queryType:"describe",index:-1},{queryType:"insert",index:-1},{queryType:"delete",index:-1}],r=!1,s=1/0;if(t=t.map(o=>(o.index=e.toLowerCase().indexOf(o.queryType),o.index!==-1&&(r=!0,o.index<s&&(s=o.index)),o)),!r)return null;let a=t.find(o=>o.index===s).queryType;return(a==="insert"||a==="delete")&&(a="update"),a}_abbreviate(e,t){let r=e;return e.indexOf("http")!==-1&&Object.entries(t).forEach(([s,n])=>{e.indexOf(n)!==-1&&(r=e.replace(n,s+":"))}),r}_createStore(){return new Promise((e,t)=>{rdfstore.create((r,s)=>{r&&t(r),e(s)})})}_executeQuery(e,t){return new Promise((r,s)=>{e.execute(t,(n,a)=>{n&&(console.error("_executeQuery# got ERROR",n),s(n)),r(a)})})}_extractNamespacesFromString(e,t){let r=t.toLowerCase().replace(/\s/g," ").split(" ").filter(o=>o!==""),s;switch(e){case X.TURTLE:{s="@prefix".toLowerCase();break}case X.SPARQL:{s="PREFIX".toLowerCase();break}default:{let o=e;throw new Error(`The type must be TURTLE or SPARQL, but was: ${o}.`)}}let n=r.reduce((o,u,l)=>(u===s&&o.push(l),o),[]),a={};return n.forEach(o=>{let u=r[o+1],l=r[o+2];l.at(-1)==="."&&(l=l.slice(0,-1)),a[u]=l}),a}_extractQNamesFromSPARQLWhereClause(e){let t,r=e.toLowerCase(),s=0,n=[],a=/\b[a-zA-Z]{2,15}:/g,o="WHERE {".toLowerCase();for(r.includes(o)&&(s=r.indexOf(o)+o.length),r=r.slice(s);(t=a.exec(r))!==null;)t.index===a.lastIndex&&a.lastIndex++,t.forEach(u=>{n.indexOf(u)===-1&&n.push(u)});return n}_getNamespaces(e){let t=new W;return new Promise((r,s)=>{t.parse(e,(n,a,o)=>{a||r(o),n&&s(n)})})}_loadTriplesInStore(e,t,r){return r||(r="text/turtle"),new Promise((s,n)=>{e.load(r,t,(a,o)=>{a&&(console.error("_loadTriplesInStore# got error",a),n(a)),s(o)})})}_mapKeys(e,t){let r=Object.keys(e).map(s=>({[t[s]||s]:e[s]}));return Object.assign({},...r)}_prepareSelectResponse(e){if(!e)return{status:404,data:void 0};if(e[0]==null)return{status:400,data:"Query returned no results"};let t=Object.keys(e[0]),r=e,s={token:"type",type:"datatype",lang:"xml:lang"};for(let a in r)if(r.hasOwnProperty(a)){for(let o in t)if(t.hasOwnProperty(o)&&(r[a][t[o]]=this._mapKeys(r[a][t[o]],s),r[a][t[o]].label="",r[a][t[o]].value)){r[a][t[o]].label=this.prefixPipe.transform(r[a][t[o]].value,I.SHORT);let u="http://www.w3.org/2001/XMLSchema#integer",l="http://www.w3.org/2001/XMLSchema#nonNegativeInteger",m=r[a][t[o]].type,p=r[a][t[o]].datatype||"";m==="literal"&&(p===u||p===l)&&(r[a][t[o]].label=+r[a][t[o]].value)}}return{status:200,data:{head:{vars:t},body:{bindings:r}}}}},ce.ctorParameters=()=>[{type:$}],ce);K=v([bt()],K);var re,ie=(re=class{constructor(e,t){this.graphVisualizerService=e,this.toastService=t,this.defaultForceGraphHeight=500}ngOnInit(){this.resetTriples(),this.resetQuery()}resetTriples(){this.graphRDFInputData.triples&&(this.triples=this.graphRDFInputData.triples)}resetQuery(e){if(!this.graphRDFInputData.queryList)return;this.queryList=JSON.parse(JSON.stringify(this.graphRDFInputData.queryList));let t=e?this.queryList.find(r=>e.queryLabel===r.queryLabel&&e.queryType===r.queryType)||e:this.queryList[0];this.query=ct({},t),this.performQuery()}performQuery(){if(this.query.queryString=this.graphVisualizerService.checkNamespacesInQuery(this.query.queryString,this.triples),this.query.queryType=this.graphVisualizerService.getQuerytype(this.query.queryString),this.query.queryType==="construct"||this.query.queryType==="select"){let e=this._queryLocalStore(this.query.queryType,this.query.queryString,this.triples);this.queryResult$=dt(e)}else this.queryResult$=Se}onGraphNodeClick(e){e&&console.info("GraphVisualizerComponent# graphClick on node",e)}onTableNodeClick(e){e&&console.info("GraphVisualizerComponent# tableClick on URI",e)}showErrorMessage(e){if(!e?.message)return;let t=new Ct(e.message,{header:e.name,classname:"bg-danger text-light",delay:e.duration});this.toastService.add(t),console.error(e.name,":",e.message)}_queryLocalStore(e,t,r){return ht(this,null,function*(){let s=Date.now(),n;try{n=yield this.graphVisualizerService.doQuery(e,t,r),this.queryTime=Date.now()-s}catch(a){console.error("#queryLocalstore got error:",a),a.message&&a.name&&(a.message.indexOf("undefined")!==-1&&this.showErrorMessage(new Y(a.name,"The query did not return any results.",5e3)),this.showErrorMessage(new Y(a.name,a.message,5e3))),this.queryTime=Date.now()-s,n=[]}return n})}},re.ctorParameters=()=>[{type:K},{type:Tt}],re.propDecorators={fs:[{type:V,args:["fs"]}],graphRDFInputData:[{type:w}],isFullscreen:[{type:w}]},re);ie=v([S({selector:"awg-graph-visualizer",template:zt,changeDetection:E.Default,styles:[Gt]})],ie);var br=`<div ngbAccordion>
    <div
        ngbAccordionItem="awg-graph-visualizer-construct-results"
        [collapsed]="false"
        [disabled]="isAccordionItemDisabled()">
        <div ngbAccordionHeader>
            <button ngbAccordionButton class="p-3">Resultat</button>
        </div>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <ng-template>
                    @if (queryResult$ | async; as queryResult) {
                        @if (isQueryResultNotEmpty(queryResult)) {
                            <!-- Force graph visualization -->
                            <awg-force-graph
                                class="full-width"
                                [currentQueryResultTriples]="queryResult"
                                [height]="defaultForceGraphHeight"
                                (clickedNodeRequest)="onGraphNodeClick($event)">
                            </awg-force-graph>
                        } @else {
                            <awg-sparql-no-results></awg-sparql-no-results>
                        }
                    } @else {
                        <awg-twelve-tone-spinner></awg-twelve-tone-spinner>
                    }
                </ng-template>
            </div>
        </div>
    </div>
</div>
`;var xr="";var he,Fe=(he=class{constructor(){this.clickedNodeRequest=new N}isQueryResultNotEmpty(e){return e.length===0?!1:e.every(t=>{let{subject:r,predicate:s,object:n}=t;return!!r&&!!s&&!!n})}isAccordionItemDisabled(){return this.isFullscreen}onGraphNodeClick(e){e&&this.clickedNodeRequest.emit(e)}},he.propDecorators={queryResult$:[{type:w}],defaultForceGraphHeight:[{type:w}],isFullscreen:[{type:w}],clickedNodeRequest:[{type:k}]},he);Fe=v([S({selector:"awg-construct-results",template:br,changeDetection:E.OnPush,styles:[xr]})],Fe);var yr=`<div
    #graphContainer
    id="awg-force-graph-container"
    class="awg-force-graph-panel-container"
    [ngStyle]="{ 'height.px': height }">
    <div class="awg-force-graph-icon-bar">
        <!-- Slider -->
        <div class="input-group input-group-sm awg-force-graph-zoom-slider-container float-start mb-3">
            <span #sliderInputLabel class="input-group-text" id="slider-label">{{ sliderConfig.value }}x</span>
            <input
                type="range"
                #sliderInput
                class="awg-force-graph-zoom-slider"
                id="awg-force-graph-zoom-slider"
                name="zoomSlider"
                aria-label="Zoom slider"
                aria-describedby="slider-label"
                [min]="sliderConfig.min"
                [max]="sliderConfig.max"
                [step]="sliderConfig.stepSize"
                [(ngModel)]="sliderConfig.value"
                (ngModelChange)="onZoomChange($event)" />
            <button class="btn btn-sm btn-outline-info" type="submit" title="Reset" (click)="onReCenter()">
                <fa-icon [icon]="faCompressArrowsAlt"></fa-icon>
            </button>
        </div>

        <!-- Limit -->
        @if (currentQueryResultTriples) {
            <div class="btn-group awg-force-graph-node-limit-container float-end my-auto">
                <button type="button" class="btn btn-sm btn-outline-info" disabled aria-disabled="true">
                    @if (limit < currentQueryResultTriples.length) {
                        <span>{{ limit }} von </span>
                    }
                    {{ currentQueryResultTriples.length }} Triples
                </button>
                <div
                    class="btn-group"
                    ngbDropdown
                    container="body"
                    role="group"
                    aria-label="Button group with nested dropdown for node limit">
                    <button
                        class="btn btn-sm btn-info dropdown-toggle"
                        ngbDropdownToggle
                        [disabled]="currentQueryResultTriples.length === 0"></button>
                    <div class="dropdown-menu" ngbDropdownMenu>
                        @for (limitValue of limitValues; track limitValue) {
                            @if (currentQueryResultTriples.length > limitValue) {
                                <button class="dropdown-item" (click)="onLimitValueChange(limitValue)">
                                    <span>{{ limitValue }}</span>
                                </button>
                            }
                        }
                        <button class="dropdown-item" (click)="onLimitValueChange(currentQueryResultTriples.length)">
                            <span>Kein Limit</span>
                        </button>
                    </div>
                </div>
            </div>
        }

        <!-- <span *ngIf="message" class="message">{{message}}</span> -->
    </div>
</div>
`;var vr=`#awg-force-graph-container{position:relative;width:100%}#awg-force-graph-container>.awg-force-graph-icon-bar{position:relative;width:100%}.awg-force-graph-panel-container{position:inherit;height:100%}.input-group.awg-force-graph-zoom-slider-container{flex-wrap:nowrap;width:auto}.input-group.awg-force-graph-zoom-slider-container>:not(:first-child){margin-left:0!important}#slider-label.input-group-text{min-width:50px;color:#149b9e}input[type=range].awg-force-graph-zoom-slider{width:100%;background-color:transparent;-webkit-appearance:none}input[type=range].awg-force-graph-zoom-slider:focus{outline:none}input[type=range].awg-force-graph-zoom-slider:focus::-ms-fill-lower{background:#ddddddc7}input[type=range].awg-force-graph-zoom-slider:focus::-ms-fill-upper{background:#e5e5e5}input[type=range].awg-force-graph-zoom-slider:focus::-webkit-slider-runnable-track{background:#e5e5e5}input[type=range].awg-force-graph-zoom-slider::-webkit-slider-runnable-track{background:#ddddddc7;border:.2px solid #dddddd;border-radius:1.3px;width:100%;height:31px;cursor:pointer}input[type=range].awg-force-graph-zoom-slider::-webkit-slider-thumb{width:15px;height:29px;background:#149b9e;border:1.8px solid #149b9e;border-radius:10px;cursor:pointer;-webkit-appearance:none}input[type=range].awg-force-graph-zoom-slider::-moz-range-track{background:#ddddddc7;border:.2px solid #dddddd;border-radius:1.3px;width:100%;height:29px;cursor:pointer;-moz-margin-start:fill;margin-right:fill}input[type=range].awg-force-graph-zoom-slider::-moz-range-thumb{width:15px;height:27px;background:#149b9e;border:1.8px solid #149b9e;border-radius:10px;cursor:pointer}input[type=range].awg-force-graph-zoom-slider::-ms-track{background:transparent;border-color:transparent;border-width:7.4px 0;color:transparent;width:100%;height:31px;cursor:pointer}input[type=range].awg-force-graph-zoom-slider::-ms-fill-lower{background:#ddddddc7;border:.2px solid #dddddd;border-radius:2.6px}input[type=range].awg-force-graph-zoom-slider::-ms-fill-upper{background:#ddddddc7;border:.2px solid #dddddd;border-radius:2.6px}input[type=range].awg-force-graph-zoom-slider::-ms-thumb{width:15px;height:29px;background:#149b9e;border:1.8px solid #149b9e;border-radius:10px;cursor:pointer;margin-top:0}:host ::ng-deep .node{stroke:#fff;fill:#ddd;stroke-width:1.5px}:host ::ng-deep .blank{stroke:#fff;fill:#000!important;stroke-width:1.5px}:host ::ng-deep .blank.instance{stroke:#fff;fill:#000;stroke-width:1.5px}:host ::ng-deep .class{stroke:#fff;fill:#9e0000;stroke-width:1.5px}:host ::ng-deep .instance{stroke:#fff;fill:#20b2aa;stroke-width:1.5px}:host ::ng-deep .instance-space{stroke:#fff;fill:#00bfff;stroke-width:1.5px}:host ::ng-deep .instance-spaceType{stroke:#fff;fill:#00008b;stroke-width:1.5px}:host ::ng-deep .link{fill:none;stroke:#999;stroke-opacity:.6;stroke-width:1px}:host ::ng-deep marker{stroke:#999;fill:#7cf00a00}:host ::ng-deep .node-text{font:15px Roboto,sans-serif;fill:#000}:host ::ng-deep .link-text{font:13px Roboto,sans-serif;fill:gray}
`;var Ie={LINK_DISTANCE:10,COLLISION_STRENGTH:1,COLLISION_RADIUS:30,CHARGE_STRENGTH:-10},se,De=(se=class{constructor(e,t){this.graphVisualizerService=e,this.prefixPipe=t,this.clickedNodeRequest=new N,this.faCompressArrowsAlt=Rt,this.limitValues=[5,10,25,50,100,250,500,1e3],this.limit=50,this.sliderConfig=new Pt(1,.1,3,.01,1),this._resize$=new Be,this._destroyed$=new Be}onResize(){!this._graphContainer||!this.currentQueryResultTriples||(this._divWidth=this._getContainerDimensions(this._graphContainer).width,this._divHeight=this._getContainerDimensions(this._graphContainer).height,this._resize$.next(!0))}ngOnInit(){this._resize$.pipe(ft(150),gt(this._destroyed$)).subscribe(e=>{this._redraw()}),this._redraw()}ngOnChanges(e){let{queryResultTriples:t}=e;t?.currentValue&&!t.isFirstChange()&&(this.currentQueryResultTriples=t.currentValue,this._redraw())}onLimitValueChange(e){this.limit=e,this._redraw()}onReCenter(){!this._svg||!(this._divWidth&&this._divHeight)||(this.onZoomChange(this.sliderConfig.initial),this._zoomBehaviour.translateTo(this._svg,this._divWidth/2,this._divHeight/2))}onZoomChange(e){this.sliderConfig.value=e,this._reScaleZoom()}log(e,t){let r=t&&JSON.parse(JSON.stringify(t));console.info(e,r)}ngOnDestroy(){this._destroyed$.next(!0),this._destroyed$.complete()}_redraw(){this.currentQueryResultTriples&&(this._cleanSVG(),this._createSVG(),this._attachData(),this._reScaleZoom())}_cleanSVG(){It("svg.force-graph > *").remove()}_createSVG(){if(!this._graphContainer)return;let e,t;this._divWidth?e=this._divWidth:this._getContainerDimensions(this._graphContainer).width?e=this._getContainerDimensions(this._graphContainer).width:e=400,this._divHeight?t=this._divHeight:this._getContainerDimensions(this._graphContainer).height?t=this._getContainerDimensions(this._graphContainer).height:t=500,this._divWidth=e,this._divHeight=t-45,this._svg||(this._svg=Ft(this._graphContainer.nativeElement).append("svg").attr("class","force-graph")),this._svg.attr("width",this._divWidth).attr("height",this._divHeight),this._zoomGroup=this._svg.append("g").attr("class","zoom-container")}_attachData(){let e=this.graphVisualizerService.limitTriples(this.currentQueryResultTriples,this.limit);typeof e=="string"?this.graphVisualizerService.parseTripleString(e).then(t=>{let r=this.graphVisualizerService.abbreviateTriples(t.triples,t.namespaces);this._simulationData=this._triplesToD3GraphData(r),this._setupForceSimulation(),this._updateSVG()}):(this._simulationData=this._triplesToD3GraphData(e),this._setupForceSimulation(),this._updateSVG())}_setupForceSimulation(){this._forceSimulation=at();let e=ot().strength(n=>this._nodeRadius(n)*Ie.CHARGE_STRENGTH),t=rt(this._divWidth/2,this._divHeight/2),r=st().strength(Ie.COLLISION_STRENGTH).radius(Ie.COLLISION_RADIUS).iterations(2),s=nt().links(this._simulationData.links).id(n=>n.predicate).distance(Ie.LINK_DISTANCE);this._forceSimulation.force("charge_force",e).force("center_force",t).force("collide_force",r),this._forceSimulation.nodes(this._simulationData.nodes),this._forceSimulation.force("links",s),this._forceSimulation.alpha(1).restart()}_updateSVG(){if(!this._svg)return;this._zoomGroup.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",30).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:polyline").attr("points","0,-5 10,0 0,5");let e=this._zoomGroup.append("g").attr("class","links").selectAll(".link").data(this._simulationData.nodeTriples).enter().append("path").attr("marker-end","url(#end)").attr("class","link"),t=this._zoomGroup.append("g").attr("class","link-texts").selectAll(".link-text").data(this._simulationData.nodeTriples).enter().append("text").attr("class","link-text").text(n=>n.nodePredicate.label),r=this._zoomGroup.append("g").attr("class","node-texts").selectAll(".node-text").data(this._filterNodesByType(this._simulationData.nodes,Q.node)).enter().append("text").attr("class","node-text").text(n=>n.label),s=this._zoomGroup.append("g").attr("class","nodes").selectAll(".node").data(this._filterNodesByType(this._simulationData.nodes,Q.node)).enter().append("circle").attr("class",n=>n.owlClass?"class":n.label.indexOf("_:")!==-1?"blank":n.instance||n.label.indexOf("inst:")!==-1?"instance":"node").attr("id",n=>n.label).attr("r",n=>n.label.indexOf("_:")!==-1?8:n.instance||n.label.indexOf("inst:")!==-1?11:n.owlClass||n.label.indexOf("inst:")!==-1?10:9).on("click",(n,a)=>{this._clickedOnNode(n,a)});this._forceSimulation.on("tick",()=>{this._updateNodePositions(s),this._updateNodeTextPositions(r),this._updateLinkPositions(e),this._updateLinkTextPositions(t)}),this._dragHandler(s,this._forceSimulation),this._zoomHandler(this._zoomGroup,this._svg)}_reScaleZoom(){!this._svg||!this.sliderConfig.value||this._zoomBehaviour.scaleTo(this._svg,this.sliderConfig.value)}_checkForRdfType(e){return e.label==="a"||e.label==="rdf:type"||e.label===this.prefixPipe.transform("rdf:type",I.LONG)}_clickedOnNode(e,t){e.defaultPrevented||this.clickedNodeRequest.emit(t)}_dragHandler(e,t){let r=(o,u)=>{o.sourceEvent.stopPropagation(),o.active||t.alphaTarget(.3).restart(),u.fx=u.x,u.fy=u.y},s=(o,u)=>{u.fx=o.x,u.fy=o.y},n=(o,u)=>{o.active||t.alphaTarget(0),u.fx=null,u.fy=null},a=Lt().on("start",r).on("drag",s).on("end",n);e.call(a)}_zoomHandler(e,t){let r=s=>{let n=s.transform,a=this._roundToNearestScaleStep(n.k);e.attr("transform",n),this._sliderInput.nativeElement.value=a,this._sliderInputLabel.nativeElement.innerText=a+"x",this.sliderConfig.value=a};this._zoomBehaviour=jt().scaleExtent([this.sliderConfig.min,this.sliderConfig.max]).on("zoom",r),t.call(this._zoomBehaviour)}_filterNodesById(e,t){return e.filter(r=>r.id===t)[0]}_filterNodesByType(e,t){return e.filter(r=>r.type===t)}_getContainerDimensions(e){return e?.nativeElement?{width:e.nativeElement.clientWidth,height:e.nativeElement.clientHeight}:null}_nodeRadius(e){if(!e)return null;let t=8;return e.label.indexOf("_:")!==-1?t=t-1:e.instance||e.label.indexOf("inst:")!==-1?t=t+2:(e.owlClass||e.label.indexOf("inst:")!==-1)&&(t=t+1),t}_roundToNearestScaleStep(e){let t=this.sliderConfig.stepSize;return((n,a)=>+(Math.round(+(n+"e"+a))+"e-"+a))(e,(n=>Math.floor(n)===n?0:n.toString().split(".")[1].length||0)(t))}_triplesToD3GraphData(e){if(!e)return;let t=new ve;return e.forEach(r=>{let s=this.prefixPipe.transform(r.subject,I.SHORT),n=this.prefixPipe.transform(r.predicate,I.SHORT),a=this.prefixPipe.transform(r.object,I.SHORT);isNaN(a)||(a=Number(a)%1===0?String(Number(a)):String(Number(a).toFixed(2)));let o=new te(n,Q.link);t.nodes.push(o);let u=this._filterNodesById(t.nodes,s);u==null&&(u=new te(s,Q.node),t.nodes.push(u));let l=this._filterNodesById(t.nodes,a);l==null&&(l=new te(a,Q.node),t.nodes.push(l)),u.instance===!1&&(u.instance=this._checkForRdfType(o)),l.owlClass===!1&&(l.owlClass=this._checkForRdfType(o)),t.links.push(new ue(u,o)),t.links.push(new ue(o,l)),t.nodeTriples.push(new we(u,o,l))}),t}_updateNodePositions(e){e.attr("cx",t=>t.x).attr("cy",t=>t.y)}_updateNodeTextPositions(e){e.attr("x",t=>t.x+12).attr("y",t=>t.y+3)}_updateLinkPositions(e){e.attr("d",t=>{let r=t.nodeSubject.x,s=t.nodeSubject.y,n=t.nodeObject.x,a=t.nodeObject.y,o=0,u=o,l=o,m=0,p=0,_=1;return r===n&&s===a&&(m=-45,p=1,u=30,l=20,n=n+1,a=a+1),"M"+r+","+s+"A"+u+","+l+" "+m+","+p+","+_+" "+n+","+a})}_updateLinkTextPositions(e){e.attr("x",t=>t.nodeSubject.x===t.nodeObject.x&&t.nodeSubject.y===t.nodeObject.y?20+(t.nodeSubject.x+t.nodePredicate.x+t.nodeObject.x)/3:10+(t.nodeSubject.x+t.nodePredicate.x+t.nodeObject.x)/3).attr("y",t=>t.nodeSubject.x===t.nodeObject.x&&t.nodeSubject.y===t.nodeObject.y?-40+(t.nodeSubject.y+t.nodePredicate.y+t.nodeObject.y)/3:4+(t.nodeSubject.y+t.nodePredicate.y+t.nodeObject.y)/3)}},se.ctorParameters=()=>[{type:K},{type:$}],se.propDecorators={currentQueryResultTriples:[{type:w}],height:[{type:w}],clickedNodeRequest:[{type:k}],_graphContainer:[{type:V,args:["graphContainer",{static:!0}]}],_sliderInput:[{type:V,args:["sliderInput",{static:!0}]}],_sliderInputLabel:[{type:V,args:["sliderInputLabel",{static:!0}]}],onResize:[{type:Ce,args:["window:resize"]}]},se);De=v([S({selector:"awg-force-graph",template:yr,styles:[vr]})],De);var wr=`<div ngbAccordion>
    <div
        ngbAccordionItem="awg-graph-visualizer-select-results"
        [collapsed]="false"
        [disabled]="isAccordionItemDisabled()">
        <div ngbAccordionHeader>
            <button ngbAccordionButton class="p-3">Resultat</button>
        </div>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <ng-template>
                    @if (queryResult$ | async; as queryResult) {
                        @if (isQueryResultNotEmpty(queryResult)) {
                            <!-- SPARQL table visualization -->
                            <awg-sparql-table
                                [queryResult]="queryResult"
                                [queryTime]="queryTime"
                                (clickedTableRequest)="onTableNodeClick($event)">
                            </awg-sparql-table>
                        } @else {
                            <awg-sparql-no-results></awg-sparql-no-results>
                        }
                    } @else {
                        <awg-twelve-tone-spinner></awg-twelve-tone-spinner>
                    }
                </ng-template>
            </div>
        </div>
    </div>
</div>
`;var Rr="";var ne,Pe=(ne=class{constructor(e){this.utils=e,this.clickedTableRequest=new N}isAccordionItemDisabled(){return this.isFullscreen}isQueryResultNotEmpty(e){let{head:t,body:r}=e;return this.utils.isNotEmptyArray(t?.vars)&&this.utils.isNotEmptyArray(r?.bindings)}onTableNodeClick(e){e&&this.clickedTableRequest.emit(e)}},ne.ctorParameters=()=>[{type:Ee}],ne.propDecorators={queryResult$:[{type:w}],queryTime:[{type:w}],isFullscreen:[{type:w}],clickedTableRequest:[{type:k}]},ne);Pe=v([S({selector:"awg-select-results",template:wr,changeDetection:E.OnPush,styles:[Rr]})],Pe);var Sr=`<div ngbAccordion>
    <div
        ngbAccordionItem="awg-graph-visualizer-sparql-query"
        [collapsed]="isAccordionItemCollapsed()"
        [disabled]="isAccordionItemDisabled()">
        <div ngbAccordionHeader class="accordion-button custom-header justify-content-between">
            <button ngbAccordionToggle class="btn btn-link m-0 p-0">SPARQL</button>
            <!-- View Handle -->
            @if (!isFullscreen) {
                <awg-view-handle-button-group
                    [viewHandles]="viewHandles"
                    [selectedViewType]="selectedViewType"
                    (viewChangeRequest)="onViewChange($event)"></awg-view-handle-button-group>
            }

            <!-- Example Query Handle -->
            @if (isExampleQueriesEnabled()) {
                <div class="p-0 btn-group awg-example-query-btn-group" style="padding: -3rem">
                    <button type="button" class="btn btn-sm btn-outline-info" disabled aria-disabled="true">
                        Beispielabfragen
                    </button>
                    <div
                        class="btn-group"
                        ngbDropdown
                        container="body"
                        placement="bottom-right"
                        role="group"
                        aria-label="Button group with nested dropdown for sample queries">
                        <button class="btn btn-sm btn-info" ngbDropdownToggle></button>
                        <div ngbDropdownMenu>
                            <h6 class="dropdown-header">Graph-Ansicht (CONSTRUCT)</h6>
                            @for (q of queryList; track q) {
                                @if (q.queryType === 'construct') {
                                    <a ngbDropdownItem [class.disabled]="q === query" (click)="onQueryListChange(q)">
                                        <span>{{ q.queryLabel }}</span>
                                    </a>
                                }
                            }
                            <div class="dropdown-divider"></div>
                            <h6 class="dropdown-header">Tabellen-Ansicht (SELECT)</h6>
                            @for (q of queryList; track q) {
                                @if (q.queryType === 'select') {
                                    <a ngbDropdownItem [class.disabled]="q === query" (click)="onQueryListChange(q)">
                                        <span>{{ q.queryLabel }}</span>
                                    </a>
                                }
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
        <div ngbAccordionCollapse [style.height]="isFullscreen ? '50vh' : 'auto'">
            <div ngbAccordionBody>
                <ng-template>
                    <!-- CodeMirror editor instance -->
                    <awg-codemirror
                        ngDefaultControl
                        [mode]="cmSparqlMode"
                        [(content)]="query.queryString"
                        (contentChange)="onEditorInputChange($event)"></awg-codemirror>

                    <!-- Handle buttons -->
                    <div fxLayout="row" class="mt-2 awg-graph-visualizer-sparql-query-handle-buttons">
                        <button class="btn btn-outline-info" (click)="performQuery()">Query</button>
                        <button class="btn btn-warning" (click)="resetQuery(query)">Reset</button>
                        <button class="btn btn-danger" (click)="onEditorInputChange('')">Clear</button>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>
`;var Cr=`.custom-header:after{content:none}.custom-header.accordion-button{padding:.8rem!important}.custom-header.accordion-button>#awg-graph-visualizer-sparql-query-toggle{text-decoration:none}
`;var H;function Nr(i){return new RegExp("^(?:"+i.join("|")+")$","i")}var Ci=Nr(["str","lang","langmatches","datatype","bound","sameterm","isiri","isuri","iri","uri","bnode","count","sum","min","max","avg","sample","group_concat","rand","abs","ceil","floor","round","concat","substr","strlen","replace","ucase","lcase","encode_for_uri","contains","strstarts","strends","strbefore","strafter","year","month","day","hours","minutes","seconds","timezone","tz","now","uuid","struuid","md5","sha1","sha256","sha384","sha512","coalesce","if","strlang","strdt","isnumeric","regex","exists","isblank","isliteral","a","bind"]),Ti=Nr(["base","prefix","select","distinct","reduced","construct","describe","ask","from","named","where","order","limit","offset","filter","optional","graph","by","asc","desc","as","having","undef","values","group","minus","in","not","service","silent","using","insert","delete","union","true","false","with","data","copy","to","move","add","create","drop","clear","load","into"]),Ei=/[*+\-<>=&|\^\/!\?]/,Tr="[A-Za-z_\\-0-9]",Ni=new RegExp("[A-Za-z]"),ki=new RegExp("(("+Tr+"|\\.)*("+Tr+"))?:");function kr(i,e){var t=i.next();if(H=null,t=="$"||t=="?")return t=="?"&&i.match(/\s/,!1)?"operator":(i.match(/^[A-Za-z0-9_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][A-Za-z0-9_\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]*/),"variableName.local");if(t=="<"&&!i.match(/^[\s\u00a0=]/,!1))return i.match(/^[^\s\u00a0>]*>?/),"atom";if(t=='"'||t=="'")return e.tokenize=qi(t),e.tokenize(i,e);if(/[{}\(\),\.;\[\]]/.test(t))return H=t,"bracket";if(t=="#")return i.skipToEnd(),"comment";if(Ei.test(t))return"operator";if(t==":")return Er(i),"atom";if(t=="@")return i.eatWhile(/[a-z\d\-]/i),"meta";if(Ni.test(t)&&i.match(ki))return Er(i),"atom";i.eatWhile(/[_\w\d]/);var r=i.current();return Ci.test(r)?"builtin":Ti.test(r)?"keyword":"variable"}function Er(i){i.match(/(\.(?=[\w_\-\\%])|[:\w_-]|\\[-\\_~.!$&'()*+,;=/?#@%]|%[a-f\d][a-f\d])+/i)}function qi(i){return function(e,t){for(var r=!1,s;(s=e.next())!=null;){if(s==i&&!r){t.tokenize=kr;break}r=!r&&s=="\\"}return"string"}}function Ae(i,e,t){i.context={prev:i.context,indent:i.indent,col:t,type:e}}function Le(i){i.indent=i.context.indent,i.context=i.context.prev}var qr={name:"sparql",startState:function(){return{tokenize:kr,context:null,indent:0,col:0}},token:function(i,e){if(i.sol()&&(e.context&&e.context.align==null&&(e.context.align=!1),e.indent=i.indentation()),i.eatSpace())return null;var t=e.tokenize(i,e);if(t!="comment"&&e.context&&e.context.align==null&&e.context.type!="pattern"&&(e.context.align=!0),H=="(")Ae(e,")",i.column());else if(H=="[")Ae(e,"]",i.column());else if(H=="{")Ae(e,"}",i.column());else if(/[\]\}\)]/.test(H)){for(;e.context&&e.context.type=="pattern";)Le(e);e.context&&H==e.context.type&&(Le(e),H=="}"&&e.context&&e.context.type=="pattern"&&Le(e))}else H=="."&&e.context&&e.context.type=="pattern"?Le(e):/atom|string|variable/.test(t)&&e.context&&(/[\}\]]/.test(e.context.type)?Ae(e,"pattern",i.column()):e.context.type=="pattern"&&!e.context.align&&(e.context.align=!0,e.context.col=i.column()));return t},indent:function(i,e,t){var r=e&&e.charAt(0),s=i.context;if(/[\]\}]/.test(r))for(;s&&s.type=="pattern";)s=s.prev;var n=s&&r==s.type;return s?s.type=="pattern"?s.col:s.align?s.col+(n?0:1):s.indent+(n?0:t.unit):0},languageData:{commentTokens:{line:"#"}}};var de,Oe=(de=class{constructor(){this.errorMessageRequest=new N,this.performQueryRequest=new N,this.resetQueryRequest=new N,this.updateQueryStringRequest=new N,this.cmSparqlMode=qr,this.faDiagramProject=Ze,this.faTable=Ve,this.selectedViewType=O.GRAPH,this.viewHandles=[new We("Graph view",O.GRAPH,Ze),new We("Table view",O.TABLE,Ve)]}ngOnInit(){this.setViewType()}ngOnChanges(e){e.query&&!e.query.isFirstChange()&&this.setViewType()}setViewType(){let e={construct:O.GRAPH,select:O.TABLE};this.selectedViewType=e[this.query?.queryType]||O.GRAPH}onViewChange(e){this.switchQueryType(e),this.onEditorInputChange(this.query.queryString),this.performQuery()}switchQueryType(e){switch(e){case O.TABLE:{this.query.queryType==="construct"&&this.query.queryString.includes("CONSTRUCT")&&(this.query.queryString=this.query.queryString.replace("CONSTRUCT","SELECT *"),this.query.queryType="select");break}case O.GRAPH:{this.query.queryType==="select"&&this.query.queryString.includes("SELECT")&&(this.query.queryString=this.query.queryString.replace(/SELECT.*\n/,`CONSTRUCT
`),this.query.queryType="construct");break}case O.GRID:break;default:{let t=e;throw new Error(`The view must be ${O.GRAPH} or ${O.TABLE}, but was: ${t}.`)}}}isExampleQueriesEnabled(){return!!(this.query?.queryType&&this.query?.queryLabel&&this.query?.queryString&&this.queryList)}onEditorInputChange(e){this.updateQueryStringRequest.emit(e)}onQueryListChange(e){e&&this.queryList&&(e=this.queryList.find(t=>e.queryLabel===t.queryLabel&&e.queryType===t.queryType)||this.queryList[0],this.resetQuery(e))}performQuery(){this.query.queryString?this.performQueryRequest.emit():this.errorMessageRequest.emit(new Y("Empty query","Please enter a SPARQL query."))}resetQuery(e){e&&this.resetQueryRequest.emit(e)}isAccordionItemCollapsed(){return!this.isFullscreen}isAccordionItemDisabled(){return this.isFullscreen}},de.propDecorators={queryList:[{type:w}],query:[{type:w}],isFullscreen:[{type:w}],errorMessageRequest:[{type:k}],performQueryRequest:[{type:k}],resetQueryRequest:[{type:k}],updateQueryStringRequest:[{type:k}]},de);Oe=v([S({selector:"awg-sparql-editor",template:Sr,changeDetection:E.OnPush,styles:[Cr]})],Oe);var Fr=`<div class="text-center">
    <p>Entschuldigung, Ihre SPARQL-Anfrage f\xFChrte leider zu keinem Ergebnis.</p>
    <p>M\xF6glicherweise k\xF6nnen Sie Ihre Anfrage anpassen.</p>
    <p>
        Ausf\xFChrliche Informationen zu SPARQL finden Sie unter:
        <a href="{{ logos?.['sparql'].href }}">{{ logos?.['sparql'].href }}</a
        >.
    </p>
    <p>
        <a href="{{ logos?.['sparql'].href }}">
            <img width="33%" src="{{ logos?.['sparql'].src }}" alt="{{ logos?.['sparql'].alt }}" />
        </a>
    </p>
</div>
`;var Ir="";var pe,je=(pe=class{constructor(e){this.coreService=e}ngOnInit(){this.provideMetaData()}provideMetaData(){this.logos=this.coreService.getLogos()}},pe.ctorParameters=()=>[{type:Et}],pe);je=v([S({selector:"awg-sparql-no-results",template:Fr,changeDetection:E.OnPush,styles:[Ir]})],je);var Dr=`@if (queryResult) {
    <awg-table
        [tableTitle]="'SELECT Anfrage'"
        [headerInputData]="queryResult.head.vars"
        [rowInputData]="queryResult.body.bindings"
        (clickedTableValueRequest)="onTableNodeClick($event)"
        (clickedTableRowRequest)="(undefined)"></awg-table>
}
`;var Pr=`ngb-highlight ::ng-deep .ngb-highlight{font-weight:700;background:#ff0}
`;var fe,ze=(fe=class{constructor(){this.clickedTableRequest=new N}onTableNodeClick(e){e&&this.clickedTableRequest.emit(e)}},fe.propDecorators={queryResult:[{type:w}],queryTime:[{type:w}],clickedTableRequest:[{type:k}]},fe);ze=v([S({selector:"awg-sparql-table",template:Dr,changeDetection:E.OnPush,styles:[Pr]})],ze);var Ar=`<div ngbAccordion>
    <div
        ngbAccordionItem="awg-graph-visualizer-triples"
        [collapsed]="isAccordionItemCollapsed()"
        [disabled]="isAccordionItemDisabled()">
        <div ngbAccordionHeader>
            <button ngbAccordionButton class="p-3">RDF Triples</button>
        </div>
        <div ngbAccordionCollapse [style.height]="isFullscreen ? '50vh' : 'auto'">
            <div ngbAccordionBody>
                <ng-template>
                    <!-- CodeMirror editor instance -->
                    <awg-codemirror
                        ngDefaultControl
                        [mode]="cmTurtleMode"
                        [(content)]="triples"
                        (contentChange)="onEditorInputChange($event)"></awg-codemirror>

                    <!-- Handle buttons -->
                    <div fxLayout="row" class="awg-graph-visualizer-triples-handle-buttons mt-2">
                        <button class="btn btn-outline-info" (click)="performQuery()">Query</button>
                        <button class="btn btn-warning" (click)="resetTriples()">Reset</button>
                        <button class="btn btn-danger" (click)="onEditorInputChange('')">Clear</button>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>
`;var Lr="";var J;function zr(i){return new RegExp("^(?:"+i.join("|")+")$","i")}var Oi=zr([]),Or=zr(["@prefix","@base","a"]),jr=/[*+\-<>=&|]/;function Gr(i,e){var t=i.next();if(J=null,t=="<"&&!i.match(/^[\s\u00a0=]/,!1))return i.match(/^[^\s\u00a0>]*>?/),"atom";if(t=='"'||t=="'")return e.tokenize=ji(t),e.tokenize(i,e);if(/[{}\(\),\.;\[\]]/.test(t))return J=t,null;if(t=="#")return i.skipToEnd(),"comment";if(jr.test(t))return i.eatWhile(jr),null;if(t==":")return"operator";if(i.eatWhile(/[_\w\d]/),i.peek()==":")return"variableName.special";var r=i.current();return Or.test(r)?"meta":t>="A"&&t<="Z"?"comment":"keyword";var r=i.current();return Oi.test(r)?null:Or.test(r)?"meta":"variable"}function ji(i){return function(e,t){for(var r=!1,s;(s=e.next())!=null;){if(s==i&&!r){t.tokenize=Gr;break}r=!r&&s=="\\"}return"string"}}function Ge(i,e,t){i.context={prev:i.context,indent:i.indent,col:t,type:e}}function ut(i){i.indent=i.context.indent,i.context=i.context.prev}var Mr={name:"turtle",startState:function(){return{tokenize:Gr,context:null,indent:0,col:0}},token:function(i,e){if(i.sol()&&(e.context&&e.context.align==null&&(e.context.align=!1),e.indent=i.indentation()),i.eatSpace())return null;var t=e.tokenize(i,e);if(t!="comment"&&e.context&&e.context.align==null&&e.context.type!="pattern"&&(e.context.align=!0),J=="(")Ge(e,")",i.column());else if(J=="[")Ge(e,"]",i.column());else if(J=="{")Ge(e,"}",i.column());else if(/[\]\}\)]/.test(J)){for(;e.context&&e.context.type=="pattern";)ut(e);e.context&&J==e.context.type&&ut(e)}else J=="."&&e.context&&e.context.type=="pattern"?ut(e):/atom|string|variable/.test(t)&&e.context&&(/[\}\]]/.test(e.context.type)?Ge(e,"pattern",i.column()):e.context.type=="pattern"&&!e.context.align&&(e.context.align=!0,e.context.col=i.column()));return t},indent:function(i,e,t){var r=e&&e.charAt(0),s=i.context;if(/[\]\}]/.test(r))for(;s&&s.type=="pattern";)s=s.prev;var n=s&&r==s.type;return s?s.type=="pattern"?s.col:s.align?s.col+(n?0:1):s.indent+(n?0:t.unit):0},languageData:{commentTokens:{line:"#"}}};var _e,Me=(_e=class{constructor(){this.errorMessageRequest=new N,this.performQueryRequest=new N,this.resetTriplesRequest=new N,this.updateTriplesRequest=new N,this.cmTurtleMode=Mr}onEditorInputChange(e){this.updateTriplesRequest.emit(e)}performQuery(){this.triples?this.performQueryRequest.emit():this.errorMessageRequest.emit(new Y("Empty triples","Please enter triple content."))}resetTriples(){this.resetTriplesRequest.emit()}isAccordionItemCollapsed(){return!this.isFullscreen}isAccordionItemDisabled(){return this.isFullscreen}},_e.propDecorators={triples:[{type:w}],isFullscreen:[{type:w}],errorMessageRequest:[{type:k}],performQueryRequest:[{type:k}],resetTriplesRequest:[{type:k}],updateTriplesRequest:[{type:k}]},_e);Me=v([S({selector:"awg-triples-editor",template:Ar,changeDetection:E.OnPush,styles:[Lr]})],Me);var Qr=`<div ngbAccordion>
    <div
        ngbAccordionItem="awg-graph-visualizer-unsupported-query-type-result"
        [collapsed]="false"
        [disabled]="isAccordionItemDisabled()">
        <div ngbAccordionHeader>
            <button ngbAccordionButton>Resultat</button>
        </div>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <p class="text-center">
                    Sorry, but the requested SPARQL query type <code>{{ queryType | uppercase }}</code> is not supported
                    yet.
                </p>
                <p class="text-center">Please try a <code>CONSTRUCT</code> or <code>SELECT</code> query instead.</p>
            </div>
        </div>
    </div>
</div>
`;var $r="";var ge,Qe=(ge=class{isAccordionItemDisabled(){return this.isFullscreen}},ge.propDecorators={queryType:[{type:w}],isFullscreen:[{type:w}]},ge);Qe=v([S({selector:"awg-unsupported-type-results",template:Qr,changeDetection:E.OnPush,styles:[$r]})],Qe);var $e=class{};$e=v([oe({imports:[Te],declarations:[Fe,De,ie,$,Pe,Oe,je,ze,Me,Qe],exports:[ie],providers:[K,$]})],$e);var Hr=`<!-- content: edition graph -->
<div>
    <!-- modal -->
    <awg-modal #modal></awg-modal>

    <!-- graph -->
    @if (editionGraphData$ | async; as editionGraphData) {
        <div class="awg-graph-view p-5 border rounded-3">
            @for (graph of editionGraphData.graph; track graph) {
                <div>
                    <!-- graph description -->
                    <div class="awg-graph-description">
                        <p>
                            So weit vorhanden, pr\xE4sentiert die vorliegende Ansicht Graph-Visualisierungen des
                            ausgew\xE4hlten Editionsbereichs: Der <em>statische Graph</em> vermittelt dabei einen von den
                            jeweiligen Editoren fixierten \xDCberblick editionsrelevanter Zusammenh\xE4nge und Abh\xE4ngigkeiten,
                            der <em>dynamische Graph</em> bietet zus\xE4tzlich einen interaktiven Zugang zu dem
                            zugrundeliegenden Datenbestand.
                            <span class="text-danger"
                                >Diese Funktionalit\xE4t ist noch nicht f\xFCr alle Skizzenbestandteile verf\xFCgbar, wird aber
                                sukzessive erg\xE4nzt.</span
                            >
                        </p>
                        @if (utils.isNotEmptyArray(graph.description) || graph.rdfData?.triples) {
                            @for (description of graph.description; track description) {
                                <p [compile-html]="description" [compile-html-ref]="ref"></p>
                            }
                        } @else {
                            <p class="awg-graph-description-empty">
                                <small class="text-muted"
                                    >[Die Graph-Visualisierungen zum Editionskomplex
                                    <span [innerHTML]="editionComplex.complexId.full"></span> erscheinen im Zusammenhang
                                    der vollsta\u0308ndigen Edition von {{ editionComplex.complexId.short }} in
                                    {{ editionRouteConstants.EDITION.short }} {{ editionComplex.series.short }}/{{
                                        editionComplex.section.short
                                    }}.]
                                </small>
                            </p>
                        }
                    </div>
                    <!-- dynamic graph -->
                    @if (graph.rdfData && graph.rdfData.triples && graph.rdfData.queryList) {
                        <div class="awg-graph-dynamic">
                            <h4>
                                Dynamischer Graph
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-info ms-2"
                                    (click)="modal.open('HINT_EDITION_GRAPH')">
                                    Hinweise zur Nutzung
                                </button>
                                @if (!isFullscreen) {
                                    <button
                                        type="button"
                                        title="Open fullscreen"
                                        class="btn btn-sm btn-outline-info ms-2"
                                        (click)="openFullscreen()">
                                        <fa-icon [icon]="faExpand"></fa-icon>
                                    </button>
                                }
                                @if (isFullscreen) {
                                    <button
                                        type="button"
                                        title="Close fullscreen"
                                        class="btn btn-sm btn-info ms-2"
                                        (click)="closeFullscreen()">
                                        <fa-icon [icon]="faCompress"></fa-icon>
                                    </button>
                                }
                            </h4>
                            <p>
                                Diese interaktive Visualisierung basiert auf Mads Holten's
                                <a href="https://github.com/MadsHolten/sparql-visualizer">SPARQL Visualizer</a>. Sie
                                modelliert den aktuellen Skizzenkomplex in Form eines
                                <a href="https://www.w3.org/RDF/">RDF</a>-Graphen. Die zugrundeliegenden RDF-Daten sind
                                unter dem Punkt <em>RDF Triples</em> einsehbar und lokal editierbar. Eine Filterung und
                                Eingrenzung dieser RDF-Daten kann mithilfe der Abfragesprache
                                <a href="https://www.w3.org/TR/sparql11-query/">SPARQL</a>
                                unter dem Punkt <em>SPARQL Abfrage</em> vorgenommen werden; in der Voreinstellung werden
                                hierbei alle vorhandenen Triples abgefragt.
                            </p>
                            <awg-graph-visualizer
                                [graphRDFInputData]="graph.rdfData"
                                [isFullscreen]="isFullscreen"></awg-graph-visualizer>
                        </div>
                    }
                    <!-- static image -->
                    @if (graph.staticImage && graph.staticImage !== '') {
                        <div class="awg-graph-static mt-3">
                            <h4>Statischer Graph</h4>
                            <div [compile-html]="graph.staticImage" [compile-html-ref]="ref"></div>
                        </div>
                    }
                </div>
            }
        </div>
    } @else {
        @if (errorObject) {
            <div class="errorMessage">
                <div class="col-12 text-center">
                    <div class="alert alert-danger">{{ errorObject | json }}</div>
                </div>
            </div>
        }
    }

    <!-- error message -->
    <ng-template #error>
        @if (errorObject) {
            <div class="errorMessage">
                <div class="col-12 text-center">
                    <div class="alert alert-danger">{{ errorObject | json }}</div>
                </div>
            </div>
        }
    </ng-template>
</div>
`;var Br="";var ae,Re=(ae=class{constructor(e,t,r,s){this.editionDataService=e,this.editionService=t,this.document=r,this.utils=s,this.isFullscreen=!1,this.faExpand=St,this.faCompress=wt,this.GRAPH_IMAGES={OP12:"",OP25:kt.GRAPH_IMAGE_OP25.route},this.errorObject=null,this.ref=this}get editionRouteConstants(){return Nt}onKeydownHandler(e){!this.document.fullscreenElement&&!this.document.mozFullScreenElement&&!this.document.webkitFullscreenElement&&(this.isFullscreen=!1)}ngOnInit(){this.getEditionGraphData()}getEditionGraphData(){this.editionGraphData$=this.editionService.getEditionComplex().pipe(_t(e=>(this.editionComplex=e,this.editionDataService.getEditionGraphData(this.editionComplex))),pt(e=>(this.errorObject=e,Se)))}openFullscreen(){let e=this.child.fs.nativeElement;this.isFullscreen=!0,!this.document.fullscreenElement&&!this.document.mozFullScreenElement&&!this.document.webkitFullscreenElement&&(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}closeFullscreen(){this.document.exitFullscreen?this.document.exitFullscreen():this.document.mozCancelFullScreen?this.document.mozCancelFullScreen():this.document.webkitExitFullscreen?this.document.webkitExitFullscreen():this.document.msExitFullscreen&&this.document.msExitFullscreen(),this.isFullscreen=!1}},ae.ctorParameters=()=>[{type:qt},{type:Dt},{type:void 0,decorators:[{type:mt,args:[vt]}]},{type:Ee}],ae.propDecorators={child:[{type:V,args:[ie]}],isFullscreen:[{type:yt,args:["class.is-fullscreen"]}],onKeydownHandler:[{type:Ce,args:["document:fullscreenchange",["$event"]]}]},ae);Re=v([S({selector:"awg-edition-graph",template:Hr,changeDetection:E.OnPush,styles:[Br]})],Re);var $i=[{path:"",component:Re,data:{title:"AWG Online Edition \u2013 Graph"}}],Ur=[Re],He=class{};He=v([oe({imports:[Ue.forChild($i)],exports:[Ue]})],He);var Vr=class{};Vr=v([oe({imports:[Te,$e,He],declarations:[Ur]})],Vr);export{Vr as EditionGraphModule};
