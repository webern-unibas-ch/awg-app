import{a as p,c as y,d as at,f as k,h as V,i as ct,l as ut,m as ft,n as ht,o as pt,p as dt,q as mt,r as M,s as J,t as _t,y as H}from"./chunk-KPVT4Y4B.js";import{J as x,a as nt,f as it,j as I,l as S,n as ot,r as R,ra as lt,t as st,v as g,w as v}from"./chunk-I22BW7O2.js";var w,z=(w=class{constructor(t){this.http=t,this._assetPath=""}getEditionSheetsData(t){this._assetPath=this._setAssetPathForEditionComplex(t);let r=this._getFolioConvoluteData(),n=this._getSvgSheetsData(),i=this._getTextcriticsListData();return R([r,n,i]).pipe(g([new ut,new ct,new J]),v(1))}getEditionGraphData(t){return this._assetPath=this._setAssetPathForEditionComplex(t),this._getGraphData().pipe(g(new ft),v(1))}getEditionIntroData(t){return this._assetPath=this._setAssetPathForEditionComplex(t),this._getIntroData().pipe(g(new ht),v(1))}getEditionReportData(t){this._assetPath=this._setAssetPathForEditionComplex(t);let r=this._getSourceListData(),n=this._getSourceDescriptionListData(),i=this._getSourceEvaluationListData(),o=this._getTextcriticsListData();return R([r,n,i,o]).pipe(g([new mt,new pt,new dt,new J]),v(1))}getEditionRowTablesData(){return this._assetPath=p.BASE_ROUTE,this._getRowTablesData().pipe(g(new at),v(1))}_setAssetPathForEditionComplex(t){let r="/",n=r+y.SERIES.route+r+t.series.route+y.SECTION.route+t.section.route+t.complexId.route;return p.BASE_ROUTE+n}_getFolioConvoluteData(){let t=p.FILES.folioConvoluteFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getGraphData(){let t=p.FILES.graphFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getIntroData(){let t=p.FILES.introFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getRowTablesData(){let t=p.FILES.rowTablesFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getSourceListData(){let t=p.FILES.sourceListFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getSourceDescriptionListData(){let t=p.FILES.sourceDescriptionListFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getSourceEvaluationListData(){let t=p.FILES.sourceEvaluationListFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getSvgSheetsData(){let t=p.FILES.svgSheetsFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getTextcriticsListData(){let t=p.FILES.textcriticsFile,r=`${this._assetPath}/${t}`;return this._getJsonData(r)}_getJsonData(t){return this.http.get(t).pipe(st(this._handleError("_getJsonData",[])))}_handleError(t,r){return n=>(this._logError(`${t} failed: ${n.message}`),ot(r))}_logError(t){console.error(t)}},w.ctorParameters=()=>[{type:lt}],w);z=S([x({providedIn:"root"})],z);var U=class{findTextcritics(t,r){return!t||!r?new M:t.find(i=>i.id===r.id)||new M}getCurrentEditionType(t,r){let i=t?.content?.[0]?.partial,o=i?t.id+i:t.id;return Object.keys(r).find(l=>this._findSvgSheetIndexById(r[l],o)>=0)}getNextSheetId(t,r,n){let i=r?.content?.[0]?.partial,o=r.id+(i||""),s=this._findSvgSheetIndexById(n,r.id);return i?this._findNextSheetIdForPartialSheet(t,n,s,o,i):this._findNextSheetIdForNonPartialSheet(t,n,s,o)}getTextcriticalCommentsForOverlays(t,r){return!t||!r?[]:t.filter(n=>r.some(i=>n.svgGroupId===i.id))}selectConvolute(t,r,n){if(!t||!r||!n)return;let o=this.getCurrentEditionType(n,r)==="sketchEditions"?n.content[0].convolute:"";return this._findConvoluteById(t,o)}selectSvgSheetById(t,r){if(!t||!r)return new V;let n={workEditions:this._findSvgSheetIndexById(t.workEditions,r),textEditions:this._findSvgSheetIndexById(t.textEditions,r),sketchEditions:this._findSvgSheetIndexById(t.sketchEditions,r)};for(let[i,o]of Object.entries(n)){if(o<0)continue;return this._getSheetWithPartialContentById(t[i],o,r)}return new V}_findConvoluteById(t,r){return t.find(i=>i.convoluteId===r)}_findNextSheetIdForPartialSheet(t,r,n,i,o){let s=r[n],a=s.content.findIndex(c=>c.partial===o)+t;return a>=0&&a<s.content?.length?s.id+s.content[a].partial:this._findNextSheetIdForNonPartialSheet(t,r,n,i)}_findNextSheetIdForNonPartialSheet(t,r,n,i){let o=n+t;if(o>=0&&o<r.length){let s=r[o],l=t>0?0:s.content.length-1;return s.id+(s.content[l]?.partial||"")}else return i}_findSvgSheetIndexById(t,r){return t.findIndex(n=>{let i=n.id;if(n.content.length>1){let o=this._findSvgSheetPartialIndexById(n,r);o>=0&&(i+=n.content[o].partial)}return i===r})}_findSvgSheetPartialIndexById(t,r){return t.content.findIndex(n=>t.id+n.partial===r)}_getSheetWithPartialContentById(t,r,n){let i=nt({},t[r]),o=this._findSvgSheetPartialIndexById(i,n);return o>=0&&(i.content=[i.content[o]]),i}};U=S([x({providedIn:"root"})],U);function ae(){}function C(e){return e==null?ae:function(){return this.querySelector(e)}}function St(e){typeof e!="function"&&(e=C(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,l=n[i]=new Array(s),a,c,u=0;u<s;++u)(a=o[u])&&(c=e.call(a,a.__data__,u,o))&&("__data__"in a&&(c.__data__=a.__data__),l[u]=c);return new f(n,this._parents)}function D(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ce(){return[]}function q(e){return e==null?ce:function(){return this.querySelectorAll(e)}}function ue(e){return function(){return D(e.apply(this,arguments))}}function xt(e){typeof e=="function"?e=ue(e):e=q(e);for(var t=this._groups,r=t.length,n=[],i=[],o=0;o<r;++o)for(var s=t[o],l=s.length,a,c=0;c<l;++c)(a=s[c])&&(n.push(e.call(a,a.__data__,c,s)),i.push(a));return new f(n,i)}function G(e){return function(){return this.matches(e)}}function B(e){return function(t){return t.matches(e)}}var fe=Array.prototype.find;function he(e){return function(){return fe.call(this.children,e)}}function pe(){return this.firstElementChild}function gt(e){return this.select(e==null?pe:he(typeof e=="function"?e:B(e)))}var de=Array.prototype.filter;function me(){return Array.from(this.children)}function _e(e){return function(){return de.call(this.children,e)}}function vt(e){return this.selectAll(e==null?me:_e(typeof e=="function"?e:B(e)))}function yt(e){typeof e!="function"&&(e=G(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o=t[i],s=o.length,l=n[i]=[],a,c=0;c<s;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&l.push(a);return new f(n,this._parents)}function N(e){return new Array(e.length)}function wt(){return new f(this._enter||this._groups.map(N),this._parents)}function b(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}b.prototype={constructor:b,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Et(e){return function(){return e}}function Se(e,t,r,n,i,o){for(var s=0,l,a=t.length,c=o.length;s<c;++s)(l=t[s])?(l.__data__=o[s],n[s]=l):r[s]=new b(e,o[s]);for(;s<a;++s)(l=t[s])&&(i[s]=l)}function xe(e,t,r,n,i,o,s){var l,a,c=new Map,u=t.length,d=o.length,m=new Array(u),h;for(l=0;l<u;++l)(a=t[l])&&(m[l]=h=s.call(a,a.__data__,l,t)+"",c.has(h)?i[l]=a:c.set(h,a));for(l=0;l<d;++l)h=s.call(e,o[l],l,o)+"",(a=c.get(h))?(n[l]=a,a.__data__=o[l],c.delete(h)):r[l]=new b(e,o[l]);for(l=0;l<u;++l)(a=t[l])&&c.get(m[l])===a&&(i[l]=a)}function ge(e){return e.__data__}function It(e,t){if(!arguments.length)return Array.from(this,ge);var r=t?xe:Se,n=this._parents,i=this._groups;typeof e!="function"&&(e=Et(e));for(var o=i.length,s=new Array(o),l=new Array(o),a=new Array(o),c=0;c<o;++c){var u=n[c],d=i[c],m=d.length,h=ve(e.call(u,u&&u.__data__,c,n)),_=h.length,j=l[c]=new Array(_),tt=s[c]=new Array(_),le=a[c]=new Array(m);r(u,d,j,tt,le,h,t);for(var E=0,F=0,et,rt;E<_;++E)if(et=j[E]){for(E>=F&&(F=E+1);!(rt=tt[F])&&++F<_;);et._next=rt||null}}return s=new f(s,n),s._enter=l,s._exit=a,s}function ve(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ct(){return new f(this._exit||this._groups.map(N),this._parents)}function Dt(e,t,r){var n=this.enter(),i=this,o=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),r==null?o.remove():r(o),n&&i?n.merge(i).order():i}function bt(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,o=n.length,s=Math.min(i,o),l=new Array(i),a=0;a<s;++a)for(var c=r[a],u=n[a],d=c.length,m=l[a]=new Array(d),h,_=0;_<d;++_)(h=c[_]||u[_])&&(m[_]=h);for(;a<i;++a)l[a]=r[a];return new f(l,this._parents)}function Tt(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],i=n.length-1,o=n[i],s;--i>=0;)(s=n[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function At(e){e||(e=ye);function t(d,m){return d&&m?e(d.__data__,m.__data__):!d-!m}for(var r=this._groups,n=r.length,i=new Array(n),o=0;o<n;++o){for(var s=r[o],l=s.length,a=i[o]=new Array(l),c,u=0;u<l;++u)(c=s[u])&&(a[u]=c);a.sort(t)}return new f(i,this._parents).order()}function ye(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Lt(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Ft(){return Array.from(this)}function Bt(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null}function Nt(){let e=0;for(let t of this)++e;return e}function $t(){return!this.node()}function Ot(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],o=0,s=i.length,l;o<s;++o)(l=i[o])&&e.call(l,l.__data__,o,i);return this}var $="http://www.w3.org/1999/xhtml",X={svg:"http://www.w3.org/2000/svg",xhtml:$,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function T(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),X.hasOwnProperty(t)?{space:X[t],local:e}:e}function we(e){return function(){this.removeAttribute(e)}}function Ee(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ie(e,t){return function(){this.setAttribute(e,t)}}function Ce(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function De(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function be(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Pt(e,t){var r=T(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?Ee:we:typeof t=="function"?r.local?be:De:r.local?Ce:Ie)(r,t))}function O(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Te(e){return function(){this.style.removeProperty(e)}}function Ae(e,t,r){return function(){this.style.setProperty(e,t,r)}}function Le(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function Rt(e,t,r){return arguments.length>1?this.each((t==null?Te:typeof t=="function"?Le:Ae)(e,t,r??"")):kt(this.node(),e)}function kt(e,t){return e.style.getPropertyValue(t)||O(e).getComputedStyle(e,null).getPropertyValue(t)}function Fe(e){return function(){delete this[e]}}function Be(e,t){return function(){this[e]=t}}function Ne(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function Vt(e,t){return arguments.length>1?this.each((t==null?Fe:typeof t=="function"?Ne:Be)(e,t)):this.node()[e]}function Mt(e){return e.trim().split(/^|\s+/)}function W(e){return e.classList||new Jt(e)}function Jt(e){this._node=e,this._names=Mt(e.getAttribute("class")||"")}Jt.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Ht(e,t){for(var r=W(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function zt(e,t){for(var r=W(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function $e(e){return function(){Ht(this,e)}}function Oe(e){return function(){zt(this,e)}}function Pe(e,t){return function(){(t.apply(this,arguments)?Ht:zt)(this,e)}}function Ut(e,t){var r=Mt(e+"");if(arguments.length<2){for(var n=W(this.node()),i=-1,o=r.length;++i<o;)if(!n.contains(r[i]))return!1;return!0}return this.each((typeof t=="function"?Pe:t?$e:Oe)(r,t))}function Re(){this.textContent=""}function ke(e){return function(){this.textContent=e}}function Ve(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function qt(e){return arguments.length?this.each(e==null?Re:(typeof e=="function"?Ve:ke)(e)):this.node().textContent}function Me(){this.innerHTML=""}function Je(e){return function(){this.innerHTML=e}}function He(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Gt(e){return arguments.length?this.each(e==null?Me:(typeof e=="function"?He:Je)(e)):this.node().innerHTML}function ze(){this.nextSibling&&this.parentNode.appendChild(this)}function Xt(){return this.each(ze)}function Ue(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Wt(){return this.each(Ue)}function qe(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===$&&t.documentElement.namespaceURI===$?t.createElement(e):t.createElementNS(r,e)}}function Ge(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function P(e){var t=T(e);return(t.local?Ge:qe)(t)}function Yt(e){var t=typeof e=="function"?e:P(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Xe(){return null}function Kt(e,t){var r=typeof e=="function"?e:P(e),n=t==null?Xe:typeof t=="function"?t:C(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function We(){var e=this.parentNode;e&&e.removeChild(this)}function Qt(){return this.each(We)}function Ye(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Ke(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Zt(e){return this.select(e?Ke:Ye)}function jt(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Qe(e){return function(t){e.call(this,t,this.__data__)}}function Ze(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function je(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,i=t.length,o;r<i;++r)o=t[r],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++n]=o;++n?t.length=n:delete this.__on}}}function tr(e,t,r){return function(){var n=this.__on,i,o=Qe(t);if(n){for(var s=0,l=n.length;s<l;++s)if((i=n[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=r),i.value=t;return}}this.addEventListener(e.type,o,r),i={type:e.type,name:e.name,value:t,listener:o,options:r},n?n.push(i):this.__on=[i]}}function te(e,t,r){var n=Ze(e+""),i,o=n.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var a=0,c=l.length,u;a<c;++a)for(i=0,u=l[a];i<o;++i)if((s=n[i]).type===u.type&&s.name===u.name)return u.value}return}for(l=t?tr:je,i=0;i<o;++i)this.each(l(n[i],t,r));return this}function ee(e,t,r){var n=O(e),i=n.CustomEvent;typeof i=="function"?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function er(e,t){return function(){return ee(this,e,t)}}function rr(e,t){return function(){return ee(this,e,t.apply(this,arguments))}}function re(e,t){return this.each((typeof t=="function"?rr:er)(e,t))}function*ne(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length,s;i<o;++i)(s=n[i])&&(yield s)}var A=[null];function f(e,t){this._groups=e,this._parents=t}function ie(){return new f([[document.documentElement]],A)}function nr(){return this}f.prototype=ie.prototype={constructor:f,select:St,selectAll:xt,selectChild:gt,selectChildren:vt,filter:yt,data:It,enter:wt,exit:Ct,join:Dt,merge:bt,selection:nr,order:Tt,sort:At,call:Lt,nodes:Ft,node:Bt,size:Nt,empty:$t,each:Ot,attr:Pt,style:Rt,property:Vt,classed:Ut,text:qt,html:Gt,raise:Xt,lower:Wt,append:Yt,insert:Kt,remove:Qt,clone:Zt,datum:jt,on:te,dispatch:re,[Symbol.iterator]:ne};var ir=ie;function L(e){return typeof e=="string"?new f([[document.querySelector(e)]],[document.documentElement]):new f([[e]],A)}function or(e){return typeof e=="string"?new f([document.querySelectorAll(e)],[document.documentElement]):new f([D(e)],A)}function oe(e){let t;for(;t=e.sourceEvent;)e=t;return e}function sr(e,t){if(e=oe(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}var Y=class{constructor(){this._bufferSize=1,this._editionComplexSubject=new I(this._bufferSize),this._editionComplexStream$=this._editionComplexSubject.asObservable(),this._isRowTableViewSubject=new I(this._bufferSize),this._isRowTableViewStream$=this._isRowTableViewSubject.asObservable(),this._selectedEditionSeriesSubject=new I(this._bufferSize),this._selectedEditionSeriesStream$=this._selectedEditionSeriesSubject.asObservable(),this._selectedEditionSectionSubject=new I(this._bufferSize),this._selectedEditionSectionStream$=this._selectedEditionSectionSubject.asObservable()}getEditionComplex(){return this._editionComplexStream$}updateEditionComplex(t){this._editionComplexSubject.next(t)}clearEditionComplex(){this._editionComplexSubject.next(null)}getEditionOutline(){return H}getEditionSeriesRoute(){return y.EDITION.route+y.SERIES.route}getEditionSeriesById(t){return H.find(r=>r.series.route===t)}getEditionSectionById(t,r){return this.getEditionSeriesById(t).sections.find(i=>i.section.route===r)}getSelectedEditionSeries(){return this._selectedEditionSeriesStream$}updateSelectedEditionSeries(t){this._selectedEditionSeriesSubject.next(t)}clearSelectedEditionSeries(){this._selectedEditionSeriesSubject.next(null)}getSelectedEditionSection(){return this._selectedEditionSectionStream$}updateSelectedEditionSection(t){this._selectedEditionSectionSubject.next(t)}clearSelectedEditionSection(){this._selectedEditionSectionSubject.next(null)}getIsRowTableView(){return this._isRowTableViewStream$}updateIsRowTableView(t){this._isRowTableViewSubject.next(t)}clearIsRowTableView(){this._isRowTableViewSubject.next(null)}};Y=S([x({providedIn:"root"})],Y);function ar(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function se(e,t){return fetch(e,t).then(ar)}function K(e){return(t,r)=>se(t,r).then(n=>new DOMParser().parseFromString(n,e))}var cr=K("application/xml"),ur=K("text/html"),Q=K("image/svg+xml");var Z=class{constructor(){this.overlayFillColor="orange",this.overlayHoverFillColor="tomato",this.overlayTransparentFillColor="transparent",this.overlaySelectionFillColor="green",this.linkBoxFillColor="#dddddd",this.linkBoxHoverFillColor="#eeeeee",this._overlayBoxesOpacity=.3,this._overlayBoxAdditionalSpace=5.5,this._overlayBoxCornerRadius=2,this._suppliedClasses=new Map,this._suppliedClassesLabelLookup=new Map([["foliation","Blattangabe"],["staffN","Systemangabe"],["measureN","Taktzahlen"],["clef","Schl\xFCssel"],["clef_key","Schl\xFCssel mit Tonart"],["key","Tonart"],["accid","Akzidenzien"],["hyphen","Silbentrennung"]])}createSvg(t,r,n){return it(this,null,function*(){if(!t||!r||!n)return;let o=(yield this._fetchSvgFile(t)).getElementsByTagName("svg")[0],s=this._getViewBox(o);for(;o.firstChild;)n.appendChild(o.firstChild);return r.appendChild(n),L(r).attr("width",s.svgWidth).attr("height",s.svgHeight).attr("viewBox",s.viewBox).attr("preserveAspectRatio","xMidYMid meet").attr("version","1.1").attr("xmlns","https://www.w3.org/2000/svg").attr("xlink","https://www.w3.org/1999/xlink")})}createOverlayGroup(t,r,n,i){if(!t||!r)return;let o=this.getD3SelectionById(t,r);return o.append("g").attr("class",`${i}-overlay-group`),o.select(`g.${i}-overlay-group`).append("rect").attr("width",n.width+this._overlayBoxAdditionalSpace*2).attr("height",n.height+this._overlayBoxAdditionalSpace*2).attr("x",n.x-this._overlayBoxAdditionalSpace).attr("y",n.y-this._overlayBoxAdditionalSpace).attr("rx",this._overlayBoxCornerRadius).attr("fill",this.overlayFillColor).attr("opacity",this._overlayBoxesOpacity).attr("class",`${i}-overlay-group-box`)}fillD3SelectionWithColor(t,r){!t||!r||t.attr("fill",r)}getContainerDimensions(t){if(!t)return{width:void 0,height:void 0};let r=t.nativeElement.clientWidth,n=t.nativeElement.clientHeight;return{width:r,height:n}}getD3SelectionById(t,r){if(!(!t||!r))return t.select("#"+r)}getGroupsBySelector(t,r){if(t)return t.selectAll("g."+r)}getOverlayGroupRectSelection(t,r,n){return!t||!r||!n?void 0:this.getD3SelectionById(t,r).select(`rect.${n}-overlay-group-box`)}getSuppliedClasses(t){return t?(this._suppliedClasses=new Map,this.getGroupsBySelector(t,"supplied").each((n,i,o)=>{let l=L(o[i]).attr("class").split(" "),a=l[l.indexOf("supplied")+1];if(a){let c=this._suppliedClassesLabelLookup.get(a)||a;this._suppliedClasses.has(c)||this._suppliedClasses.set(c,!0)}}),this._suppliedClasses):void 0}toggleSuppliedClassOpacity(t,r,n){if(!t)return;let i=Array.from(this._suppliedClassesLabelLookup.entries()).find(([a,c])=>c===r)?.[0]||r,o=i?`supplied.${i}`:"supplied",s=this.getGroupsBySelector(t,o),l=n?0:1;s.style("opacity",l)}updateTkkOverlayColor(t,r,n){let i=this._getTkkOverlayColor(t,n);this.fillD3SelectionWithColor(r,i)}_fetchSvgFile(t){return Q(t)}_getTkkOverlayColor(t,r){return t?r===k.transparent?this.overlayTransparentFillColor:t.isSelected?this.overlaySelectionFillColor:r===k.hover?this.overlayHoverFillColor:this.overlayFillColor:this.overlayFillColor}_getViewBox(t){let n=L(t).attr("viewBox").split(" "),i=+n[2],o=+n[3];return new _t(i,o)}};Z=S([x({providedIn:"root"})],Z);export{z as a,U as b,T as c,C as d,q as e,G as f,kt as g,ir as h,L as i,sr as j,or as k,Z as l,Y as m};
